{% extends 'base.html' %}
{% load static %}

{% block title %}Calculadora CLT vs. PJ - Vetorial{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/calculadora.css' %}">
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const display = document.getElementById('display');
    const hiddenInput = document.getElementById('salario_bruto_hidden');
    const form = document.getElementById('formCalculadora');
    
    // Bot√µes num√©ricos
    document.querySelectorAll('.btn-numero').forEach(btn => {
        btn.addEventListener('click', function() {
            const valor = this.getAttribute('data-valor');
            let displayAtual = display.value;
            
            if (displayAtual === '0.00' || displayAtual === '0') {
                display.value = valor === '.' ? '0.' : valor;
            } else {
                // Prevenir m√∫ltiplos pontos
                if (valor === '.' && displayAtual.includes('.')) return;
                display.value = displayAtual + valor;
            }
        });
    });
    
    // Bot√£o Limpar
    document.querySelector('.btn-limpar').addEventListener('click', function() {
        display.value = '0.00';
    });
    
    // Bot√£o Apagar
    document.querySelector('.btn-apagar').addEventListener('click', function() {
        let displayAtual = display.value;
        display.value = displayAtual.length > 1 ? displayAtual.slice(0, -1) : '0.00';
    });
    
    // Ao submeter form
    form.addEventListener('submit', function(e) {
        hiddenInput.value = display.value.replace(',', '.');
        if (parseFloat(hiddenInput.value) <= 0) {
            e.preventDefault();
            alert('Por favor, digite um valor v√°lido maior que zero.');
        }
    });
});
</script>
{% endblock %}

{% block content %}
<section class="calculadora-section">
    <div class="container">
        <!-- Header -->
        <div class="calculadora-header">
            <h1>üßÆ Calculadora CLT vs. PJ</h1>
            <p>Compare quanto voc√™ receberia como CLT ou PJ e tome a melhor decis√£o para sua carreira</p>
        </div>
        
        <!-- Calculadora Real -->
        <div class="row justify-content-center">
            <div class="col-lg-5 col-md-8">
                <div class="calculadora-fisica">
                    <div class="calc-marca">VETORIAL</div>
                    
                    <!-- Display LCD -->
                    <div class="calc-display">
                        <div class="display-label">SAL√ÅRIO BRUTO MENSAL</div>
                        <input 
                            type="text" 
                            class="display-valor" 
                            id="display" 
                            value="0.00" 
                            readonly
                        >
                    </div>
                    
                    <!-- Teclado Num√©rico -->
                    <div class="calc-teclado">
                        <button type="button" class="calc-btn btn-numero" data-valor="7">7</button>
                        <button type="button" class="calc-btn btn-numero" data-valor="8">8</button>
                        <button type="button" class="calc-btn btn-numero" data-valor="9">9</button>
                        <button type="button" class="calc-btn btn-limpar">CE</button>
                        
                        <button type="button" class="calc-btn btn-numero" data-valor="4">4</button>
                        <button type="button" class="calc-btn btn-numero" data-valor="5">5</button>
                        <button type="button" class="calc-btn btn-numero" data-valor="6">6</button>
                        <button type="button" class="calc-btn btn-apagar">‚Üê</button>
                        
                        <button type="button" class="calc-btn btn-numero" data-valor="1">1</button>
                        <button type="button" class="calc-btn btn-numero" data-valor="2">2</button>
                        <button type="button" class="calc-btn btn-numero" data-valor="3">3</button>
                        <button type="button" class="calc-btn btn-numero" data-valor="0" style="grid-column: 1 / 3;">0</button>
                        
                        <button type="button" class="calc-btn btn-numero" data-valor=".">.</button>
                        <button type="button" class="calc-btn btn-numero" data-valor="00">00</button>
                        
                        <!-- Bot√£o Calcular -->
                        <form method="POST" id="formCalculadora" style="grid-column: 1 / 5; margin-top: 1rem;">
                            {% csrf_token %}
                            <input type="hidden" name="salario_bruto" id="salario_bruto_hidden">
                            <button type="submit" class="calc-btn btn-calcular-principal">
                                = CALCULAR
                            </button>
                        </form>
                    </div>
                </div>
                
                <div class="calc-instrucoes">
                    <p>üí° Digite o valor do sal√°rio usando os bot√µes acima e clique em <strong>CALCULAR</strong></p>
                </div>
            </div>
        </div>
        
        <!-- Resultados -->
        {% if resultados %}
        <div class="mt-5">
            <div class="resultado-header">
                <h2>üìä Resultados da Compara√ß√£o</h2>
                <p class="text-muted">Sal√°rio Bruto: <strong>R$ {{ resultados.salario_bruto|floatformat:2 }}</strong></p>
            </div>
            
            <div class="row">
                <!-- CLT -->
                <div class="col-lg-6 mb-4">
                    <div class="resultado-card clt">
                        <div class="text-center">
                            <span class="regime-badge clt">CLT</span>
                        </div>
                        
                        <div class="salario-bruto">
                            Sal√°rio Bruto: <strong>R$ {{ resultados.salario_bruto|floatformat:2 }}</strong>
                        </div>
                        
                        <h5 class="mb-3 h5-strong">Descontos:</h5>
                        
                        <div class="desconto-item">
                            <span class="desconto-label">INSS</span>
                            <span class="desconto-valor">- R$ {{ resultados.clt_inss|floatformat:2 }}</span>
                        </div>
                        
                        <div class="desconto-item">
                            <span class="desconto-label">IRRF (Imposto de Renda)</span>
                            <span class="desconto-valor">- R$ {{ resultados.clt_irrf|floatformat:2 }}</span>
                        </div>
                        
                        <div class="total-descontos">
                            <div class="desconto-item">
                                <span class="desconto-label"><strong>Total de Descontos</strong></span>
                                <span class="desconto-valor"><strong>- R$ {{ resultados.clt_total_descontos|floatformat:2 }}</strong></span>
                            </div>
                        </div>
                        
                        <div class="salario-liquido">
                            <div class="salario-liquido-label">Sal√°rio L√≠quido Mensal</div>
                            <div class="salario-liquido-valor">R$ {{ resultados.clt_salario_liquido|floatformat:2 }}</div>
                        </div>
                        
                        <div class="beneficios-section">
                            <div class="beneficios-title">
                                ‚ú® Benef√≠cios Anuais (n√£o inclusos no l√≠quido)
                            </div>
                            <div class="beneficio-item">
                                <span>13¬∫ Sal√°rio</span>
                                <strong class="text-accent-clt">R$ {{ resultados.clt_decimo_terceiro|floatformat:2 }}</strong>
                            </div>
                            <div class="beneficio-item">
                                <span>F√©rias + 1/3</span>
                                <strong class="text-accent-clt">R$ {{ resultados.clt_ferias|floatformat:2 }}</strong>
                            </div>
                            <div class="beneficio-item">
                                <span>FGTS (8% ao ano)</span>
                                <strong class="text-accent-clt">R$ {{ resultados.clt_fgts_anual|floatformat:2 }}</strong>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- PJ -->
                <div class="col-lg-6 mb-4">
                    <div class="resultado-card pj">
                        <div class="text-center">
                            <span class="regime-badge pj">PJ (Pessoa Jur√≠dica)</span>
                        </div>
                        
                        <div class="salario-bruto">
                            Faturamento Bruto: <strong>R$ {{ resultados.salario_bruto|floatformat:2 }}</strong>
                        </div>
                        
                        <h5 class="mb-3 h5-strong">Impostos:</h5>
                        
                        <div class="desconto-item">
                            <span class="desconto-label">Simples Nacional ({{ resultados.pj_aliquota }}%)</span>
                            <span class="desconto-valor">- R$ {{ resultados.pj_imposto|floatformat:2 }}</span>
                        </div>
                        
                        <div class="total-descontos pj">
                            <div class="desconto-item">
                                <span class="desconto-label"><strong>Total de Impostos</strong></span>
                                <span class="desconto-valor"><strong>- R$ {{ resultados.pj_imposto|floatformat:2 }}</strong></span>
                            </div>
                        </div>
                        
                        <div class="salario-liquido">
                            <div class="salario-liquido-label">Faturamento L√≠quido Mensal</div>
                            <div class="salario-liquido-valor">R$ {{ resultados.pj_salario_liquido|floatformat:2 }}</div>
                        </div>
                        
                        <div class="beneficios-section beneficios-pj" style="margin-top: 2.9rem;">
                            <div class="beneficios-title">
                                ‚ö†Ô∏è Importante para PJ
                            </div>
                            <ul class="list-beneficios-pj">
                                <li>Sem 13¬∫ sal√°rio</li>
                                <li>Sem f√©rias remuneradas</li>
                                <li>Sem FGTS</li>
                                <li>Necess√°rio contribuir ao INSS separadamente</li>
                                <li>Custos operacionais (contador, etc.)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Compara√ß√£o Final -->
            <div class="comparacao-final">
                <div class="comparacao-title">üéØ Diferen√ßa Mensal</div>
                
                {% if resultados.diferenca > 0 %}
                    <p class="text-muted-small">
                        Como <strong class="text-accent-pj">PJ</strong>, voc√™ receberia:
                    </p>
                    <div class="diferenca-valor positiva">
                        + R$ {{ resultados.diferenca|floatformat:2 }}
                    </div>
                    <div class="diferenca-percentual">
                        ({{ resultados.diferenca_percentual|floatformat:1 }}% a mais por m√™s)
                    </div>
                {% else %}
                    <p class="text-muted-small">
                        Como <strong class="text-accent-clt">CLT</strong>, voc√™ receberia:
                    </p>
                    <div class="diferenca-valor negativa">
                        R$ {{ resultados.diferenca|floatformat:2 }}
                    </div>
                    <div class="diferenca-percentual">
                        ({{ resultados.diferenca_percentual|floatformat:1 }}% a menos por m√™s como PJ)
                    </div>
                {% endif %}
            </div>
            
            <!-- Aviso Importante -->
            <div class="aviso-importante">
                <h6>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                    </svg>
                    Aviso Importante
                </h6>
                <ul>
                    <li><strong>Esta √© uma estimativa simplificada.</strong> Os c√°lculos reais podem variar conforme sua situa√ß√£o espec√≠fica.</li>
                    <li>Para PJ, consideramos apenas a al√≠quota inicial do Simples Nacional (6%). A al√≠quota real varia conforme o faturamento acumulado.</li>
                    <li>N√£o foram considerados: dependentes, dedu√ß√µes m√©dicas, pens√£o aliment√≠cia, pr√≥-labore, distribui√ß√£o de lucros, entre outros.</li>
                    <li>Como PJ, voc√™ precisa reservar valores para f√©rias, 13¬∫ sal√°rio e previd√™ncia, que n√£o est√£o inclusos no c√°lculo.</li>
                    <li><strong>Recomendamos consultar um contador</strong> para uma an√°lise completa e personalizada da sua situa√ß√£o.</li>
                </ul>
            </div>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
