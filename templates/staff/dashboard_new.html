{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Staff - Vetorial</title>
    <link rel="icon" href="{% static 'img/favicon.ico' %}" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
    :root {
        --primary-color: #0079bf; /* Trello Blue */
        --primary-hover: #026aa7;
        --sidebar-bg: #1F2937;
        --sidebar-text: #D1D5DB;
        --content-bg: #0079bf; /* Trello Background */
        --card-bg: #FFFFFF;
        --text-primary: #172b4d;
        --text-secondary: #5e6c84;
        --border-color: #dfe1e6;
        --success-color: #10B981;
        --danger-color: #EF4444;
        --warning-color: #F59E0B;
        --kanban-column-bg: #ebecf0;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background: var(--content-bg);
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        height: 100vh;
        overflow: hidden;
    }

    /* Layout Principal */
    .staff-dashboard {
        display: flex;
        flex-direction: column;
        height: 100vh;
    }

    /* Header Topo (Estilo Trello) */
    .trello-header {
        height: 48px;
        background: rgba(0,0,0,0.15);
        display: flex;
        align-items: center;
        padding: 0 16px;
        gap: 16px;
        backdrop-filter: blur(4px);
    }
    
    .trello-logo {
        color: white; /* Make logo white or use image */
        font-weight: bold;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        gap: 8px;
        opacity: 0.8;
    }
    
    .trello-logo:hover {
        opacity: 1;
        background: rgba(255,255,255,0.2);
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
    }

    .trello-board-header {
        display: flex;
        align-items: center;
        padding: 8px 16px;
        gap: 16px;
    }
    
    .trello-board-title {
        font-size: 1.15rem;
        font-weight: 700;
        color: white;
    }

    /* √Årea de Conte√∫do */
    .content-area {
        flex: 1;
        padding: 0;
        overflow-x: auto;
        display: flex;
        flex-direction: column;
    }

    /* Esconder elementos antigos */
    .sidebar, .content-header, .actions-bar {
        display: none !important;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
        width: 12px;
        height: 12px;
    }
    
    ::-webkit-scrollbar-track {
        background: rgba(0,0,0,0.1);
        border-radius: 6px;
    }
    
    ::-webkit-scrollbar-thumb {
        background: rgba(255,255,255,0.3);
        border-radius: 6px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: rgba(255,255,255,0.4);
    }

    /* Kanban Board Styles Update */
    .kanban-container {
        display: flex;
        gap: 12px;
        overflow-x: auto;
        padding: 12px 16px;
        align-items: flex-start;
        height: 100%;
        width: 100%;
    }

    .kanban-column {
        min-width: 272px;
        max-width: 272px;
        background: var(--kanban-column-bg);
        border-radius: 3px;
        display: flex;
        flex-direction: column;
        max-height: calc(100vh - 100px);
        border: none;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    .kanban-column-header {
        padding: 10px 12px;
        background: transparent;
        border-radius: 3px 3px 0 0;
        border-top: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: none;
        cursor: pointer;
    }

    .kanban-column-title {
        font-size: 0.9rem;
        font-weight: 600;
        color: #172b4d;
        text-transform: none;
    }

    .kanban-column-count {
        background: rgba(9, 30, 66, 0.08); /* Neutral count */
        color: #172b4d;
    }

    .kanban-column-content {
        padding: 0 8px 8px 8px;
        gap: 8px;
        min-height: 20px;
    }

    .kanban-card {
        background: #FFFFFF;
        border-radius: 3px;
        padding: 8px 10px;
        box-shadow: 0 1px 0 rgba(9, 30, 66, 0.25);
        border: none;
        margin-bottom: 0;
    }

    .kanban-card:hover {
        transform: none;
        background-color: #F4F5F7;
        border-bottom-color: rgba(9, 30, 66, 0.25);
    }
    
    .kanban-card.dragging {
        background: #e4e6ea;
        box-shadow: none;
        transform: rotate(2deg);
    }

    .kanban-card-header {
        margin-bottom: 4px;
    }
    
    .kanban-card-protocol {
        font-size: 0.7rem;
        color: #5e6c84;
    }

    /* Labels Trello style */
    .kanban-card-priority {
         padding: 2px 0;
         border-radius: 4px;
         font-size: 0; /* Hide text, show color bar */
         height: 8px;
         width: 40px;
         display: block;
         margin-bottom: 4px;
    }
    
    .kanban-card-priority::after {
        content: ''; /* No content needed for color bar only, or hover for tooltip */
    }
    
    .kanban-card-priority.baixa { background-color: #61bd4f; }
    .kanban-card-priority.media { background-color: #f2d600; }
    .kanban-card-priority.alta { background-color: #eb5a46; }
    .kanban-card-priority.urgente { background-color: #c377e0; }

    .kanban-card-title {
        font-weight: 500;
        font-size: 0.9rem;
        color: #172b4d;
        margin-bottom: 4px;
        line-height: 1.3;
    }

    .kanban-card-client {
        font-size: 0.85rem;
        color: #5e6c84;
        margin-bottom: 0;
        display: none; /* Hide client for cleaner look unless essential */
    }
    
    .kanban-card-footer {
        border-top: none;
        padding-top: 6px;
        margin-top: 2px;
    }
        transform: translateY(-50%);
        color: var(--text-secondary);
        width: 18px;
        height: 18px;
    }

    .btn-primary {
        background: var(--primary-color);
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.95rem;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s ease;
    }

    .btn-primary:hover {
        background: var(--primary-hover);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    /* Card de Dados */
    .data-card {
        background: var(--card-bg);
        border-radius: 16px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    /* Tabela */
    .data-table {
        width: 100%;
        border-collapse: collapse;
    }

    .data-table thead {
        background: #F9FAFB;
        border-bottom: 2px solid var(--border-color);
    }

    .data-table th {
        padding: 16px 20px;
        text-align: left;
        font-weight: 600;
        font-size: 0.875rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .data-table tbody tr {
        border-bottom: 1px solid var(--border-color);
        transition: background 0.2s ease;
    }

    .data-table tbody tr:hover {
        background: #F9FAFB;
    }

    .data-table td {
        padding: 16px 20px;
        color: var(--text-primary);
        font-size: 0.95rem;
    }

    /* Status Badges */
    .badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8125rem;
        font-weight: 600;
        gap: 6px;
        white-space: nowrap;
    }

    .badge-success {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success-color);
    }

    .badge-warning {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning-color);
    }

    .badge-danger {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger-color);
    }

    .badge-info {
        background: rgba(59, 130, 246, 0.1);
        color: var(--primary-color);
    }

    /* Bot√µes de A√ß√£o */
    .action-buttons {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .btn-action {
        padding: 8px 12px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        white-space: nowrap;
    }

    .btn-edit {
        background: rgba(59, 130, 246, 0.1);
        color: var(--primary-color);
    }

    .btn-edit:hover {
        background: rgba(59, 130, 246, 0.2);
    }

    .btn-delete {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger-color);
    }

    .btn-delete:hover {
        background: rgba(239, 68, 68, 0.2);
    }

    .btn-whatsapp {
        background: rgba(37, 211, 102, 0.1);
        color: #25D366;
    }

    .btn-whatsapp:hover {
        background: rgba(37, 211, 102, 0.2);
    }

    .btn-view {
        background: rgba(99, 102, 241, 0.1);
        color: #6366F1;
    }

    .btn-view:hover {
        background: rgba(99, 102, 241, 0.2);
    }

    /* Modal */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 3000;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    .modal-overlay.active {
        display: flex;
    }

    .modal-content {
        background: white;
        border-radius: 16px;
        max-width: 700px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .modal-header {
        padding: 24px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin: 0;
    }

    .modal-close {
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
        border-radius: 8px;
        color: var(--text-secondary);
        transition: all 0.2s ease;
    }

    .modal-close:hover {
        background: #F3F4F6;
        color: var(--text-primary);
    }

    .modal-body {
        padding: 24px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-label {
        display: block;
        font-weight: 600;
        font-size: 0.875rem;
        color: var(--text-primary);
        margin-bottom: 8px;
    }

    .form-control {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        font-size: 0.95rem;
        transition: all 0.2s ease;
        font-family: inherit;
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .modal-footer {
        padding: 24px;
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: flex-end;
        gap: 12px;
    }

    .btn-secondary {
        background: #F3F4F6;
        color: var(--text-primary);
        padding: 12px 24px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .btn-secondary:hover {
        background: #E5E7EB;
    }

    /* Chat de Chamados */
    .chat-container {
        max-height: 500px;
        overflow-y: auto;
        padding: 16px;
        background: #F9FAFB;
        border-radius: 12px;
        margin-bottom: 16px;
    }

    .chat-message {
        margin-bottom: 16px;
        display: flex;
        gap: 12px;
    }

    .message-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--primary-color);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.875rem;
        flex-shrink: 0;
    }

    .message-avatar.staff {
        background: var(--success-color);
    }

    .message-content {
        flex: 1;
    }

    .message-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 4px;
    }

    .message-author {
        font-weight: 600;
        font-size: 0.875rem;
        color: var(--text-primary);
    }

    .message-time {
        font-size: 0.75rem;
        color: var(--text-secondary);
    }

    .message-text {
        background: white;
        padding: 12px 16px;
        border-radius: 12px;
        font-size: 0.95rem;
        line-height: 1.5;
        color: var(--text-primary);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 64px 32px;
    }

    .empty-state-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 24px;
        opacity: 0.3;
    }

    .empty-state-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 8px;
    }

    .empty-state-text {
        color: var(--text-secondary);
        margin-bottom: 24px;
    }

    /* Responsivo */
    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
        }

        .sidebar.active {
            transform: translateX(0);
        }

        .content-area {
            margin-left: 0;
        }

        .actions-bar {
            flex-direction: column;
            align-items: stretch;
        }

        .search-box {
            min-width: 100%;
            max-width: 100%;
        }

        .data-table {
            font-size: 0.875rem;
        }

        .data-table th,
        .data-table td {
            padding: 12px 16px;
        }
    }

    /* Alert */
    .alert {
        padding: 16px 20px;
        border-radius: 12px;
        margin-bottom: 24px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .alert-success {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success-color);
        border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .alert-error {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger-color);
        border: 1px solid rgba(239, 68, 68, 0.2);
    }

    /* Kanban Board */
    .kanban-container {
        display: flex;
        gap: 24px;
        overflow-x: auto;
        padding-bottom: 20px;
        align-items: flex-start;
        height: calc(100vh - 240px);
    }

    .kanban-column {
        flex: 1;
        min-width: 300px;
        background: #F3F4F6;
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        max-height: 100%;
        border: 1px solid var(--border-color);
    }

    .kanban-column-header {
        padding: 16px;
        background: #FFFFFF;
        border-radius: 12px 12px 0 0;
        border-top: 4px solid transparent; /* Color set in JS */
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1px;
        border-bottom: 1px solid var(--border-color);
    }

    .kanban-column-title {
        font-size: 0.95rem;
        font-weight: 700;
        color: var(--text-primary);
        text-transform: uppercase;
        margin: 0;
    }

    .kanban-column-count {
        background: #E5E7EB;
        color: var(--text-secondary);
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .kanban-column-content {
        padding: 16px;
        overflow-y: auto;
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .kanban-card {
        background: #FFFFFF;
        border-radius: 8px;
        padding: 16px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        border: 1px solid var(--border-color);
        position: relative;
    }

    .kanban-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        border-color: var(--primary-color);
    }
    
    .kanban-card.dragging {
        opacity: 0.5;
        border: 2px dashed var(--primary-color);
        background: #F9FAFB;
    }

    .kanban-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
    }
    
    .kanban-card-protocol {
        font-size: 0.75rem;
        color: var(--text-secondary);
        font-weight: 500;
    }

    .kanban-card-priority {
         padding: 2px 6px;
         border-radius: 4px;
         font-size: 0.7rem;
         font-weight: 700;
         text-transform: uppercase;
    }
    
    .kanban-card-priority.baixa { background: #E0F2FE; color: #0284C7; }
    .kanban-card-priority.media { background: #FEF3C7; color: #D97706; }
    .kanban-card-priority.alta { background: #FEE2E2; color: #DC2626; }
    .kanban-card-priority.urgente { background: #991B1B; color: #FFFFFF; }

    .kanban-card-title {
        font-weight: 600;
        font-size: 0.95rem;
        color: var(--text-primary);
        margin-bottom: 8px;
        line-height: 1.4;
    }

    .kanban-card-client {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.85rem;
        color: #4B5563;
        margin-bottom: 12px;
    }
    
    .kanban-card-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-top: 1px solid #F3F4F6;
        padding-top: 12px;
        font-size: 0.75rem;
        color: var(--text-secondary);
    }
    
    .kanban-card-date {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    /* Modal Styling Adjustments */
    .modal-content {
        animation: modalSlideIn 0.3s ease;
    }

    /* Client Card Styles */
    .client-card {
        background: #FFFFFF;
        border-radius: 3px;
        padding: 10px;
        box-shadow: 0 1px 0 rgba(9, 30, 66, 0.25);
        border: none;
        margin-bottom: 8px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        gap: 6px;
    }
    
    .client-card:hover {
        background-color: #F4F5F7;
    }

    .client-avatar {
        width: 24px;
        height: 24px;
        background: #dfe1e6;
        border-radius: 50%;
        color: #172b4d;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: 700;
    }
    
    .client-name {
        font-weight: 600;
        color: #172b4d;
        font-size: 0.95rem;
    }
    
    .client-email {
        font-size: 0.8rem;
        color: #5e6c84;
    }
    
    /* Panel/Modal Styles */
    .client-panel-overlay {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background: rgba(0,0,0,0.6);
        z-index: 2000;
        display: none;
        justify-content: flex-end;
    }
    
    .client-panel {
        width: 1100px; /* Wider for details */
        max-width: 95%;
        background: #F4F5F7;
        height: 100%;
        box-shadow: -2px 0 10px rgba(0,0,0,0.2);
        display: flex;
        flex-direction: column;
        animation: slideInRight 0.3s ease;
    }

    /* Tabs inside Panel */
    .panel-tabs {
        display: flex;
        background: white;
        padding: 0 24px;
        border-bottom: 1px solid #dfe1e6;
        gap: 8px;
        overflow-x: auto;
    }
    .panel-tab {
        padding: 16px 12px;
        font-weight: 500;
        cursor: pointer;
        color: #5e6c84;
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
        white-space: nowrap;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .panel-tab:hover {
        color: #0052cc;
        background: #f4f5f7;
    }
    .panel-tab.active {
        color: #0052cc;
        border-bottom-color: #0052cc;
        font-weight: 600;
        background: transparent;
    }
    .tab-content {
        display: none;
        flex: 1; /* Take remaining height */
    }
    .tab-content.active {
        display: flex;
        flex-direction: column;
        gap: 24px;
        animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideInRight {
        from { transform: translateX(100%); }
        to { transform: translateX(0); }
    }
    
    .client-panel-header {
        background: #FFFFFF;
        padding: 20px 24px;
        border-bottom: 1px solid #dfe1e6;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .client-panel-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #172b4d;
    }
    
    .client-panel-close {
        cursor: pointer;
        color: #5e6c84;
        padding: 8px;
        border-radius: 4px;
    }
    
    .client-panel-close:hover {
         background-color: rgba(9, 30, 66, 0.08);
         color: #172b4d;
    }
    
    .client-panel-content {
        flex: 1;
        overflow-y: auto;
        padding: 24px;
        display: flex;
        flex-direction: column;
        gap: 24px;
    }
    
    .panel-section {
        background: #FFFFFF;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    
    .panel-section-header {
        font-weight: 600;
        color: #172b4d;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 1rem;
        border-bottom: 2px solid #dfe1e6;
        padding-bottom: 8px;
    }
    
    .action-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 12px;
    }
    
    .action-card {
        background: #FAFBFC;
        border: 1px solid #dfe1e6;
        border-radius: 4px;
        padding: 16px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .action-card:hover {
        background: #ebecf0;
        border-color: #c1c7d0;
    }
    
    .items-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .list-item {
        padding: 12px;
        background: #FAFBFC;
        border: 1px solid #dfe1e6;
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    /* Client Card Styles */
    .client-card {
        background: #FFFFFF;
        border-radius: 3px;
        padding: 8px 10px;
        box-shadow: 0 1px 0 rgba(9, 30, 66, 0.25);
        border: none;
        margin-bottom: 8px;
        cursor: pointer;
    }
    .client-card:hover {
        background-color: #F4F5F7;
    }
    .client-avatar {
        width: 32px;
        height: 32px;
        background: #dfe1e6;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #172b4d;
        font-size: 12px;
    }
    .client-name {
        font-weight: 500;
        color: #172b4d;
        font-size: 0.9rem;
    }
    .client-email {
        font-size: 0.75rem;
        color: #5e6c84;
    }

</style>
</head>
<body>
<div class="staff-dashboard">
    <!-- Trello Header -->
    <header class="trello-header">
         <div class="trello-logo">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                <path d="M4 4h16a2 2 0 012 2v12a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2zm0 2v12h16V6H4zm3 2h4v8H7V8zm6 0h4v5h-4V8z"/>
            </svg>
            Vetorial Board
         </div>
         <div class="trello-board-header">
             <h1 class="trello-board-title">Quadro de Atendimentos</h1>
         </div>
         <div style="margin-left: auto;">
             <a href="/" style="color: white; text-decoration: none; font-size: 0.9rem; opacity: 0.8; font-weight: 500;">Sair</a>
         </div>
    </header>

    <!-- √Årea de Conte√∫do -->
    <main class="content-area">
        <div class="content-header" style="display: none;">
            <h1 class="content-title" id="content-title">Chamados</h1>
            <p class="content-subtitle" id="content-subtitle">Gerencie todos os leads capturados do site</p>
        </div>

        <div class="actions-bar" style="display: none;">
            <div class="search-box">
                <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                <input type="text" id="searchInput" placeholder="Buscar...">
            </div>
            <button class="btn-primary" id="btnAddNew">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                <span id="btnAddNewText">Adicionar Novo</span>
            </button>
        </div>

        <div id="dataCard">
            <!-- Board will be rendered here -->
        </div>
    </main>
</div>
                <a href="#" class="menu-item" data-model="certidoes">
                    <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                    </svg>
                    <span class="menu-item-text">Certid√µes Negativas</span>
                </a>
                <a href="#" class="menu-item" data-model="documentos-empresa">
                    <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"/>
                    </svg>
                    <span class="menu-item-text">Documentos da Empresa</span>
                </a>
                <a href="#" class="menu-item" data-model="extratos-bancarios">
                    <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                    </svg>
                    <span class="menu-item-text">Extratos Banc√°rios</span>
                </a>
                <a href="#" class="menu-item" data-model="testimonials">
                    <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                    </svg>
                    <span class="menu-item-text">Depoimentos</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-section-title">Blog</div>
                <a href="#" class="menu-item" data-model="posts">
                    <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/>
                    </svg>
                    <span class="menu-item-text">Posts</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-section-title">Servi√ßos</div>
                <a href="#" class="menu-item" data-model="planos">
                    <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span class="menu-item-text">Planos</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-section-title">Documentos</div>
                <a href="#" class="menu-item" data-model="documents">
                    <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                    </svg>
                    <span class="menu-item-text">Documentos</span>
                </a>
            </div>
        </nav>
    </aside>

    <!-- √Årea de Conte√∫do -->
    <main class="content-area">
        <div id="alertContainer"></div>

        <div class="content-header">
            <h1 class="content-title" id="content-title">Leads</h1>
            <p class="content-subtitle" id="content-subtitle">Gerencie todos os leads capturados do site</p>
        </div>

        <div class="actions-bar">
            <div class="search-box">
                <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                <input type="text" id="searchInput" placeholder="Buscar...">
            </div>
            <button class="btn-primary" id="btnAddNew">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                <span id="btnAddNewText">Adicionar Novo</span>
            </button>
        </div>

        <div class="data-card" id="dataCard">
            <table class="data-table" id="dataTable">
                <thead id="tableHead">
                    <!-- Headers ser√£o carregados dinamicamente -->
                </thead>
                <tbody id="tableBody">
                    <!-- Dados ser√£o carregados aqui via JavaScript -->
                </tbody>
            </table>
        </div>
    </main>
</div>

<!-- Modal de Chamado Detalhes -->
<div class="modal-overlay" id="chamadoModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="chamadoTitle"></h3>
            <button class="modal-close" onclick="closeChamadoModal()">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <div id="chamadoInfo" style="margin-bottom: 24px;">
                <!-- Informa√ß√µes do chamado -->
            </div>
            
            <div class="chat-container" id="chatContainer">
                <!-- Mensagens ser√£o carregadas aqui -->
            </div>

            <div class="form-group">
                <label class="form-label" for="respondMessage">Responder ao Cliente</label>
                <textarea class="form-control" id="respondMessage" rows="4" placeholder="Digite sua resposta..."></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeChamadoModal()">Fechar</button>
            <button class="btn-primary" onclick="sendResponse()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                </svg>
                Enviar Resposta
            </button>
        </div>
    </div>
</div>

<!-- Modal de Enviar Nota Fiscal -->
<div class="modal-overlay" id="nfModal">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h3 class="modal-title">Enviar Nota Fiscal</h3>
            <button class="modal-close" onclick="closeNFModal()">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <form id="nfForm" enctype="multipart/form-data">
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="nfCliente">Cliente *</label>
                    <select class="form-control" id="nfCliente" required>
                        <option value="">Selecione um cliente...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="nfArquivo">Arquivo da Nota Fiscal * (PDF, XML ou ZIP)</label>
                    <input type="file" class="form-control" id="nfArquivo" accept=".pdf,.xml,.zip" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="nfObservacoes">Observa√ß√µes (opcional)</label>
                    <textarea class="form-control" id="nfObservacoes" rows="3" placeholder="Informa√ß√µes adicionais sobre a nota fiscal..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeNFModal()">Cancelar</button>
                <button type="submit" class="btn-primary">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                    </svg>
                    Enviar Nota Fiscal
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal de Documento da Empresa -->
<div class="modal-overlay" id="documentoEmpresaModal">
    <div class="modal-content" style="max-width: 550px;">
        <div class="modal-header">
            <h3 class="modal-title">Enviar Documento da Empresa</h3>
            <button class="modal-close" onclick="closeDocumentoEmpresaModal()">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <form id="documentoEmpresaForm" enctype="multipart/form-data">
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="docEmpresaCliente">Cliente *</label>
                    <select class="form-control" id="docEmpresaCliente" required>
                        <option value="">Selecione um cliente...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="docEmpresaTitulo">T√≠tulo do Documento *</label>
                    <input type="text" class="form-control" id="docEmpresaTitulo" placeholder="Ex: Contrato Social da Empresa" required>
                    <small style="color: var(--text-secondary); font-size: 0.875rem;">Nome descritivo do documento</small>
                </div>

                <div class="form-group">
                    <label class="form-label" for="docEmpresaCategoria">Categoria *</label>
                    <select class="form-control" id="docEmpresaCategoria" required>
                        <option value="">Selecione a categoria...</option>
                        <option value="contrato_social">üìã Contrato Social</option>
                        <option value="alvara">üè¢ Alvar√°</option>
                        <option value="certidao">üìú Certid√£o</option>
                        <option value="procuracao">‚úçÔ∏è Procura√ß√£o</option>
                        <option value="registro">üìù Registro</option>
                        <option value="declaracao">üìÑ Declara√ß√£o</option>
                        <option value="relatorio">üìä Relat√≥rio</option>
                        <option value="outros">üìÅ Outros</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="docEmpresaArquivo">Arquivo *</label>
                    <input type="file" class="form-control" id="docEmpresaArquivo" required>
                    <small style="color: var(--text-secondary); font-size: 0.875rem;">Aceita PDF, DOC, DOCX, XLS, XLSX, ZIP</small>
                </div>

                <div class="form-group">
                    <label class="form-label" for="docEmpresaDescricao">Descri√ß√£o (opcional)</label>
                    <textarea class="form-control" id="docEmpresaDescricao" rows="2" placeholder="Informa√ß√µes adicionais sobre o documento..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeDocumentoEmpresaModal()">Cancelar</button>
                <button type="submit" class="btn-primary">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                    </svg>
                    Enviar Documento
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal de Certid√£o Negativa -->
<div class="modal-overlay" id="certidaoModal">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h3 class="modal-title">Enviar Certid√£o Negativa</h3>
            <button class="modal-close" onclick="closeCertidaoModal()">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <form id="certidaoForm" enctype="multipart/form-data">
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="certidaoCliente">Cliente *</label>
                    <select class="form-control" id="certidaoCliente" required>
                        <option value="">Selecione um cliente...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="certidaoTipo">Tipo de Certid√£o *</label>
                    <select class="form-control" id="certidaoTipo" required>
                        <option value="">Selecione o tipo...</option>
                        <option value="federal">üèõÔ∏è Certid√£o Federal</option>
                        <option value="estadual">üè¢ Certid√£o Estadual</option>
                        <option value="trabalhista">üë∑ Certid√£o Trabalhista</option>
                        <option value="fgts">üíº Certid√£o FGTS</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="certidaoStatus">Status da Certid√£o *</label>
                    <select class="form-control" id="certidaoStatus" required>
                        <option value="negativa">‚úÖ Negativa (Sem d√©bitos)</option>
                        <option value="positiva">‚ö†Ô∏è Positiva (Com d√©bitos)</option>
                        <option value="indisponivel">‚ùå Indispon√≠vel</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="certidaoArquivo">Arquivo da Certid√£o * (PDF ou ZIP)</label>
                    <input type="file" class="form-control" id="certidaoArquivo" accept=".pdf,.zip" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeCertidaoModal()">Cancelar</button>
                <button type="submit" class="btn-primary">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                    </svg>
                    Enviar Certid√£o
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal de Guia de Imposto -->
<div class="modal-overlay" id="guiaModal">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h3 class="modal-title">Enviar Guia de Imposto</h3>
            <button class="modal-close" onclick="closeGuiaModal()">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <form id="guiaForm" enctype="multipart/form-data">
            <div class="modal-body">
                <input type="hidden" id="guiaClienteVal" name="cliente_id">
                
                <div class="form-group">
                    <label class="form-label" for="guiaTipo">Tipo de Imposto *</label>
                    <select class="form-control" id="guiaTipo" name="tipo" required>
                        <option value="das">DAS</option>
                        <option value="inss">INSS</option>
                        <option value="fgts">FGTS</option>
                        <option value="irrf">IRRF</option>
                        <option value="iss">ISS</option>
                        <option value="icms">ICMS</option>
                         <option value="pis">PIS</option>
                         <option value="cofins">COFINS</option>
                         <option value="csll">CSLL</option>
                         <option value="irpj">IRPJ</option>
                        <option value="outros">Outros</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="guiaValor">Valor (R$) *</label>
                    <input type="number" step="0.01" class="form-control" id="guiaValor" name="valor" required>
                </div>
                
                <div class="form-group grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div>
                        <label class="form-label" for="guiaVencimento">Vencimento *</label>
                        <input type="date" class="form-control" id="guiaVencimento" name="vencimento" required>
                    </div>
                    <div>
                        <label class="form-label" for="guiaCompetencia">Compet√™ncia *</label>
                        <input type="date" class="form-control" id="guiaCompetencia" name="competencia" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="guiaArquivo">Arquivo PDF *</label>
                    <input type="file" class="form-control" id="guiaArquivo" accept=".pdf" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeGuiaModal()">Cancelar</button>
                <button type="submit" class="btn-primary">Enviar Guia</button>
            </div>
        </form>
    </div>
</div>

<!-- Client Management Panel -->
<div class="client-panel-overlay" id="clientPanel">
    <div class="client-panel">
        <div class="client-panel-header">
            <div>
                <h2 class="client-panel-title" id="panelClientName">Cliente Nome</h2>
                <div style="font-size: 0.9rem; color: #5e6c84;" id="panelClientEmail">email@exemplo.com</div>
            </div>
            <div class="client-panel-close" onclick="closeClientPanel()">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </div>
        </div>
        <div class="client-panel-content" style="padding: 0; display: block; overflow: hidden;">
            
            <!-- ABAS -->
            <div class="panel-tabs">
                <div class="panel-tab active" onclick="switchTab('tab-visao-geral')">
                    Vis√£o Geral
                </div>
                <div class="panel-tab" onclick="switchTab('tab-fiscal')">
                    Fiscal (NFs)
                </div>
                <div class="panel-tab" onclick="switchTab('tab-financeiro')">
                    Financeiro
                </div>
                <div class="panel-tab" onclick="switchTab('tab-impostos')">
                    Impostos
                </div>
                 <div class="panel-tab" onclick="switchTab('tab-empresa')">
                    Minha Empresa
                </div>
                <div class="panel-tab" onclick="switchTab('tab-atendimento')">
                    Atendimento
                </div>
            </div>

            <!-- CONTE√öDO DAS ABAS -->
            <div style="padding: 24px; overflow-y: auto; height: calc(100% - 60px);">
                
                <!-- TAB: VIS√ÉO GERAL -->
                <div id="tab-visao-geral" class="tab-content active">
                     <!-- Card do Plano -->
                     <div class="panel-section">
                        <div class="panel-section-header">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                            Plano Atual
                        </div>
                        <div id="planInfoContainer" style="display: flex; justify-content: space-between; align-items: center;">
                            <div>Loading...</div>
                        </div>
                     </div>

                    <!-- A√ß√µes R√°pidas -->
                    <div class="panel-section">
                        <div class="panel-section-header">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                            A√ß√µes R√°pidas
                        </div>
                        <div class="action-grid">
                            <div class="action-card" onclick="startAction('nf')">
                                <div style="font-size: 24px; margin-bottom: 8px;">üìë</div>
                                <div style="font-weight: 500;">Enviar Nota Fiscal</div>
                            </div>
                            <div class="action-card" onclick="startAction('guia')">
                                <div style="font-size: 24px; margin-bottom: 8px;">üí∏</div>
                                <div style="font-weight: 500;">Enviar Guia</div>
                            </div>
                            <div class="action-card" onclick="startAction('doc')">
                                <div style="font-size: 24px; margin-bottom: 8px;">üìÅ</div>
                                <div style="font-weight: 500;">Enviar Documento</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB: FISCAL (NFs) -->
                <div id="tab-fiscal" class="tab-content">
                    <div class="panel-section">
                        <div class="panel-section-header">
                            Notas Fiscais Enviadas/Recebidas
                            <button class="btn-primary" style="margin-left: auto; padding: 4px 12px; font-size: 0.8rem;" onclick="openNFModal(currentSelectedClientId)">Nova NF</button>
                        </div>
                        <div class="items-list" id="panelNFsList">Loading...</div>
                    </div>
                </div>

                <!-- TAB: FINANCEIRO -->
                <div id="tab-financeiro" class="tab-content">
                    <div class="panel-section">
                        <div class="panel-section-header">Extratos Banc√°rios</div>
                        <div class="items-list" id="panelExtratosList">Loading...</div>
                    </div>
                     <div class="panel-section">
                        <div class="panel-section-header">Transmiss√µes Mensais</div>
                        <div class="items-list" id="panelTransmissoesList">Loading...</div>
                    </div>
                </div>

                <!-- TAB: IMPOSTOS -->
                <div id="tab-impostos" class="tab-content">
                     <div class="panel-section">
                        <div class="panel-section-header">
                            Guias de Imposto
                             <button class="btn-primary" style="margin-left: auto; padding: 4px 12px; font-size: 0.8rem;" onclick="openGuiaModal(currentSelectedClientId)">Enviar Guia</button>
                        </div>
                        <div class="items-list" id="panelGuiasList">Loading...</div>
                    </div>
                     <div class="panel-section">
                        <div class="panel-section-header">
                            Certid√µes Negativas
                            <button class="btn-primary" style="margin-left: auto; padding: 4px 12px; font-size: 0.8rem;" onclick="openCertidaoModal(currentSelectedClientId)">Nova Certid√£o</button>
                        </div>
                        <div class="items-list" id="panelCertidoesList">Loading...</div>
                    </div>
                </div>

                <!-- TAB: EMPRESA -->
                <div id="tab-empresa" class="tab-content">
                    <div class="panel-section">
                        <div class="panel-section-header">Status de Abertura</div>
                        <div id="panelAberturaStatus">Loading...</div>
                    </div>
                    <div class="panel-section">
                        <div class="panel-section-header">
                            Documentos da Empresa
                            <button class="btn-primary" style="margin-left: auto; padding: 4px 12px; font-size: 0.8rem;" onclick="openDocumentoEmpresaModal(currentSelectedClientId)">Enviar Documento</button>
                        </div>
                         <div class="items-list" id="panelDocsEmpresaList">Loading...</div>
                    </div>
                </div>

                <!-- TAB: ATENDIMENTO -->
                <div id="tab-atendimento" class="tab-content">
                    <div class="panel-section">
                        <div class="panel-section-header">Chamados em Aberto</div>
                         <div class="items-list" id="panelChamadosList">Loading...</div>
                    </div>
                </div>
            
            </div>
        </div>
    </div>
</div>

<script>
    let currentModel = 'clientes'; // Mudan√ßa para Clientes
    let currentSelectedClientId = null;

    // === CLIENT BOARD FUNCTIONS ===

    function renderClientsBoard() {
        console.log('Rendering Clients Board', currentData);
        const container = document.getElementById('dataCard');
        container.innerHTML = '';
        container.classList.remove('data-card');
        container.style.background = 'transparent';
        container.style.boxShadow = 'none';
        
        if (currentData.length === 0) {
            container.innerHTML = `
                <div style="padding: 20px; text-align: center; background: #fff; border-radius: 8px;">
                    <h3>Nenhum cliente encontrado</h3>
                    <p>Verifique se os usu√°rios est√£o ativos e n√£o s√£o superusu√°rios.</p>
                </div>
            `;
            return;
        }

        // Definir colunas baseadas em Fase ou Status
        const columns = [
            { id: 'fase_1', title: 'Fase 1 - Planejamento', color: '#6B7280' },
            { id: 'fase_2', title: 'Fase 2 - Viabilidade', color: '#6B7280' },
            { id: 'fase_3', title: 'Fase 3 - Registro', color: '#6B7280' },
            { id: 'fase_4', title: 'Fase 4 - Inscri√ß√µes', color: '#6B7280' },
            { id: 'ativos', title: 'Clientes Ativos', color: '#10B981' } // Fallback/Main
        ];

        const board = document.createElement('div');
        board.className = 'kanban-container';
        
        columns.forEach(col => {
            const colItems = currentData.filter(item => {
                const f = (item.fase || '').toString().toLowerCase();
                const cid = col.id.toLowerCase();
                
                if (cid === 'ativos') {
                     // Show in Ativos if it's NOT one of the specific phases, OR if it's explicitly actives/fase_7
                    const knownPhases = ['fase_1', 'fase_2', 'fase_3', 'fase_4'];
                    if (!knownPhases.includes(item.fase)) return true;
                    return false;
                }
                return item.fase === col.id;
            });
            
            // Show all columns for structure, or hide empty ones if preferred
            // if (colItems.length === 0 && col.id !== 'ativos') return;

            const colDiv = document.createElement('div');
            colDiv.className = 'kanban-column';
            
            colDiv.innerHTML = `
                <div class="kanban-column-header">
                    <h3 class="kanban-column-title">${col.title}</h3>
                    <span class="kanban-column-count">${colItems.length}</span>
                </div>
                <div class="kanban-column-content">
                    ${colItems.map(item => createClientCardHTML(item)).join('')}
                </div>
            `;
            board.appendChild(colDiv);
        });

        container.appendChild(board);
    }

    function createClientCardHTML(item) {
        const initials = (item.nome || '?').split(' ').map(n=>n[0]).join('').substring(0,2).toUpperCase();
        const safeName = (item.nome || '').replace(/'/g, "\\'");
        return `
            <div class="client-card" onclick="openClientPanel(${item.id}, '${safeName}', '${item.email}')">
                <div style="display: flex; gap: 10px; align-items: center;">
                    <div class="client-avatar">${initials}</div>
                    <div style="overflow: hidden;">
                        <div class="client-name">${item.nome}</div>
                        <div class="client-email">${item.email}</div>
                    </div>
                </div>
            </div>
        `;
    }

    // === CLIENT PANEL LOGIC ===
    
    function switchTab(tabId) {
        const tabs = document.querySelectorAll('.panel-tab');
        const contents = document.querySelectorAll('.tab-content');
        
        tabs.forEach(t => t.classList.remove('active'));
        contents.forEach(c => c.classList.remove('active'));
        
        // Find tab element (this might be called from onclick)
        const targetTab = Array.from(tabs).find(t => t.getAttribute('onclick').includes(tabId));
        if(targetTab) targetTab.classList.add('active');
        
        document.getElementById(tabId).classList.add('active');
    }

    async function openClientPanel(id, nome, email) {
        currentSelectedClientId = id;
        document.getElementById('panelClientName').textContent = nome;
        document.getElementById('panelClientEmail').textContent = email;
        document.getElementById('clientPanel').style.display = 'flex';
        
        // Reset Tab to first one
        document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelector('.panel-tab').classList.add('active'); 
        document.getElementById('tab-visao-geral').classList.add('active');

        // Loaders
        const loaders = ['panelNFsList', 'panelChamadosList', 'panelExtratosList', 'panelGuiasList', 
                         'panelCertidoesList', 'panelDocsEmpresaList', 'planInfoContainer'];
        loaders.forEach(lId => {
            const el = document.getElementById(lId);
            if(el) el.innerHTML = '<div style="text-align: center; color: #5e6c84; padding: 20px;">Carregando...</div>';
        });
        
        // Setup Company Status from currentData cache
        const client = currentData.find(c => c.id === id);
        const statusDiv = document.getElementById('panelAberturaStatus');
        if(client && statusDiv) {
             statusDiv.innerHTML = `
                <div style="padding: 16px; background: #eff6ff; border-radius: 8px; border: 1px solid #dbeafe;">
                    <div style="color: #1e40af; font-weight: 600; margin-bottom: 4px;">Fase Atual</div>
                    <div style="font-size: 1.1rem; color: #1e3a8a; margin-bottom: 8px;">${client.fase_display || 'N√£o identificada'}</div>
                    
                    <div style="display: flex; gap: 8px; align-items: center; margin-top: 12px; border-top: 1px solid #dbeafe; padding-top: 12px;">
                        <div style="flex:1;">
                            <label style="font-size: 0.8rem; color: #5e6c84; display:block; margin-bottom: 4px;">Alterar Fase:</label>
                            <select id="changePhaseSelect" class="form-control" style="font-size: 0.9rem; padding: 6px;">
                                <option value="fase_1" ${client.fase=='fase_1'?'selected':''}>Fase 1 - Planejamento</option>
                                <option value="fase_2" ${client.fase=='fase_2'?'selected':''}>Fase 2 - Viabilidade</option>
                                <option value="fase_3" ${client.fase=='fase_3'?'selected':''}>Fase 3 - Registro</option>
                                <option value="fase_4" ${client.fase=='fase_4'?'selected':''}>Fase 4 - Inscri√ß√µes</option>
                                <option value="fase_7" ${client.fase=='fase_7'?'selected':''}>Fase 7 - Ativa</option>
                            </select>
                        </div>
                        <button class="btn-primary" style="padding: 8px 16px; height: 38px; margin-top: 18px;" onclick="updateClientPhase(${client.id})">Salvar</button>
                    </div>
                </div>
             `;
        }

        // --- FETCH DATA ---
        
        // 1. Chamados
        fetch(`${API_BASE}/chamados/`)
            .then(r=>r.json())
            .then(d => {
                if(d.success) renderPanelChamados(d.data.filter(c => c.cliente_email === email));
            });

        // 2. NFs
        fetch(`${API_BASE}/notas-fiscais/`)
            .then(r=>r.json())
            .then(d => {
                if(d.success) renderPanelNFs(d.data.filter(n => n.cliente_email === email));
            });

        // 3. Extratos (Requires ID)
        fetch(`${API_BASE}/extratos-bancarios/clientes/${id}/`)
            .then(r=>r.json())
            .then(d => {
                if(d.success) renderPanelExtratos(d.data);
            });
            
        // 3b. Transmiss√µes (Movimenta√ß√µes)
        fetch(`${API_BASE}/contabilidade/clientes/${id}/movimentacoes/`)
            .then(r=>r.json())
            .then(d => {
                 if(d.success) renderPanelTransmissoes(d.data);
            });

        // 4. Guias (New Endpoint)
        fetch(`${API_BASE}/guias/`)
            .then(r=>r.json())
            .then(d => {
                if(d.success) renderPanelGuias(d.data.filter(g => g.cliente_email === email));
            });

        // 5. Certid√µes
        fetch(`${API_BASE}/certidoes/`)
            .then(r=>r.json())
            .then(d => {
                if(d.success) renderPanelCertidoes(d.data.filter(c => c.cliente_email === email));
            });
            
        // 6. Docs Empresa
        fetch(`${API_BASE}/documentos-empresa/`)
            .then(r=>r.json())
            .then(d => {
                if(d.success) renderPanelDocsEmpresa(d.data.filter(d => d.cliente_email === email));
            });
            
        // 7. Plano Details
        fetch(`${API_BASE}/cliente-assinatura/${id}/`)
            .then(r=>r.json())
            .then(d => {
                if(d.success) renderPanelPlano(d.data, d.planos_disponiveis);
            });
    }

    function closeClientPanel() {
        document.getElementById('clientPanel').style.display = 'none';
        currentSelectedClientId = null;
    }
    
    // --- RENDER FUNCTIONS ---

    function renderPanelGuias(list) {
        const container = document.getElementById('panelGuiasList');
        if(!list || list.length === 0) {
            container.innerHTML = '<div class="empty-state">Nenhuma guia encontrada.</div>'; return;
        }
        container.innerHTML = list.map(item => `
            <div class="list-item">
                <div>
                     <div style="font-weight: 600;">${item.tipo} - ${item.competencia}</div>
                     <div style="font-size: 0.8rem; color: #5e6c84;">Venc: ${item.vencimento} | R$ ${item.valor}</div>
                </div>
                 <div style="display: flex; gap: 8px; align-items: center;">
                    <span class="status-badge status-${item.status_raw}">${item.status}</span>
                    ${item.arquivo_url ? `<a href="${item.arquivo_url}" target="_blank">PDF</a>` : ''}
                </div>
            </div>
        `).join('');
    }

    function renderPanelExtratos(list) {
         const container = document.getElementById('panelExtratosList');
        if(!list || list.length === 0) {
            container.innerHTML = '<div class="empty-state">Nenhum extrato encontrado.</div>'; return;
        }
        container.innerHTML = list.map(item => `
            <div class="list-item">
                <div>
                     <div style="font-weight: 600;">Extrato ${item.mes_ano || ''}</div>
                     <div style="font-size: 0.8rem; color: #5e6c84;">Enviado em: ${item.data_upload}</div>
                </div>
                ${item.arquivo_url ? `<a href="${item.arquivo_url}" target="_blank">Baixar</a>` : ''}
            </div>
        `).join('');
    }

    function renderPanelTransmissoes(list) {
        const container = document.getElementById('panelTransmissoesList');
        if(!list || list.length === 0) {
            container.innerHTML = '<div class="empty-state">Nenhuma movimenta√ß√£o/transmiss√£o.</div>'; return;
        }
        container.innerHTML = list.map(item => `
            <div class="list-item">
                 <div>
                     <div style="font-weight: 600;">Compet√™ncia ${item.mes_ano || ''}</div>
                     <div style="font-size: 0.8rem; color: #5e6c84;">Saldo: ${item.saldo_formatado}</div>
                </div>
               <div style="font-size: 0.8rem; font-weight: 500;">Rec: ${item.total_receitas_formatado} | Desp: ${item.total_despesas_formatado}</div>
            </div>
        `).join('');
    }
    
    function renderPanelCertidoes(list) {
         const container = document.getElementById('panelCertidoesList');
        if(!list || list.length === 0) {
            container.innerHTML = '<div class="empty-state">Nenhuma certid√£o.</div>'; return;
        }
        container.innerHTML = list.map(item => `
            <div class="list-item">
                 <div>
                     <div style="font-weight: 600;">${item.tipo}</div>
                     <div style="font-size: 0.8rem; color: #5e6c84;">${item.data_envio}</div>
                </div>
                <a href="${item.arquivo_url}" target="_blank">Ver</a>
            </div>
        `).join('');
    }

    function renderPanelDocsEmpresa(list) {
         const container = document.getElementById('panelDocsEmpresaList');
        if(!list || list.length === 0) {
            container.innerHTML = '<div class="empty-state">Nenhum documento.</div>'; return;
        }
        container.innerHTML = list.map(item => `
            <div class="list-item">
                 <div>
                     <div style="font-weight: 600;">${item.titulo}</div>
                     <div style="font-size: 0.8rem; color: #5e6c84;">${item.categoria}</div>
                </div>
                ${item.arquivo_url ? `<a href="${item.arquivo_url}" target="_blank">Baixar</a>` : ''}
            </div>
        `).join('');
    }
    
    function renderPanelPlano(currentPlan, availablePlans) {
        const container = document.getElementById('planInfoContainer');
        window.availablePlans = availablePlans; // Store for context
        
        // Helper to generate options
        const getOptions = (selectedId) => {
             if(!availablePlans || availablePlans.length === 0) return '<option value="">Nenhum plano cadastrado</option>';
             return availablePlans.map(p => 
                `<option value="${p.id}" ${(selectedId && p.id == selectedId) ? 'selected' : ''}>${p.nome} (R$ ${p.preco})</option>`
             ).join('');
        };

        let html = '';

        if(!currentPlan) {
            // Caso: Sem plano ativo
            html = `
                <div style="margin-bottom: 12px;">
                     <div style="font-weight: 600; color: #EF4444; margin-bottom: 4px;">Sem plano ativo</div>
                     <div style="font-size: 0.85rem; color: #5e6c84;">Selecione um plano para ativar:</div>
                </div>
                <div style="display:flex; flex-direction: column; gap: 8px;">
                    <select id="newPlanSelect" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #dfe1e6; background: white;">
                        <option value="">-- Selecione o Plano --</option>
                        ${getOptions(null)}
                    </select>
                    <button class="btn-primary" style="width: 100%; justify-content: center; padding: 8px;" onclick="submitPlanChange(false)">
                        Ativar Plano
                    </button>
                </div>
            `;
        } else {
            // Caso: Plano Ativo (Mostrar info e bot√£o alterar)
            html = `
                <div id="planDisplayMode">
                    <div style="margin-bottom: 12px;">
                         <div style="font-weight: 700; color: #10B981; font-size: 1.1rem; margin-bottom: 4px;">${currentPlan.plano_nome}</div>
                         <div style="font-size: 0.85rem; color: #5e6c84; display: flex; flex-direction: column; gap: 2px;">
                            <span>üìÖ Ativo desde ${currentPlan.data_inicio}</span>
                            <span>üí∞ R$ ${currentPlan.valor}/m√™s</span>
                            <span>STATUS: <strong style="color: #10B981;">${currentPlan.status || 'ATIVO'}</strong></span>
                         </div>
                    </div>
                    <button class="btn-secondary" style="width: 100%; padding: 8px; font-size: 0.9rem;" onclick="togglePlanEditMode(true)">Alterar Plano</button>
                </div>
                
                <div id="planEditMode" style="display:none;">
                    <div style="font-size: 0.9rem; font-weight: 600; color: #172b4d; margin-bottom: 8px;">Alterar Plano</div>
                    <div style="display:flex; flex-direction: column; gap: 8px;">
                        <select id="changePlanSelect" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #dfe1e6; background: white;">
                             ${getOptions(currentPlan.plano_id)}
                        </select>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn-primary" style="flex: 1; justify-content: center; padding: 8px;" onclick="submitPlanChange(true)">Salvar</button>
                            <button class="btn-secondary" style="flex: 1; padding: 8px;" onclick="togglePlanEditMode(false)">Cancelar</button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        container.innerHTML = html;
    }
    
    function togglePlanEditMode(show) {
        document.getElementById('planDisplayMode').style.display = show ? 'none' : 'block';
        document.getElementById('planEditMode').style.display = show ? 'block' : 'none';
    }

    function submitPlanChange(isEdit) {
        const selectId = isEdit ? 'changePlanSelect' : 'newPlanSelect';
        const selectEl = document.getElementById(selectId);
        const newPlanId = selectEl.value;
        const button = isEdit ? document.querySelector('#planEditMode .btn-primary') : document.querySelector('#planInfoContainer .btn-primary');
        
        if(!newPlanId) {
            alert('Por favor, selecione um plano da lista.');
            return;
        }

        const originalText = button.textContent;
        button.textContent = 'Salvando...';
        button.disabled = true;

        const formData = new FormData();
        formData.append('cliente_id', currentSelectedClientId);
        formData.append('plano_id', newPlanId);
        
        fetch(`${API_BASE}/cliente-assinatura/update/`, {
            method: 'POST',
            headers: {'X-CSRFToken': csrftoken},
            body: formData
        }).then(r=>r.json()).then(d => {
            if(d.success) {
                // Reload plan info
                 fetch(`${API_BASE}/cliente-assinatura/${currentSelectedClientId}/`)
                    .then(r=>r.json()).then(newData => renderPanelPlano(newData.data, newData.planos_disponiveis));
                 // showAlert('Plano atualizado com sucesso!'); // Optional
            } else {
                alert('Erro: ' + (d.error || 'Erro desconhecido'));
                button.textContent = originalText;
                button.disabled = false;
            }
        }).catch(err => {
            console.error(err);
            alert('Erro de conex√£o ao atualizar plano.');
            button.textContent = originalText;
            button.disabled = false;
        });
    }

    /* REMOVED promptUpdatePlan OLD FUNCTION */

    function renderPanelChamados(list) {
        const container = document.getElementById('panelChamadosList');
        if(!list || list.length === 0) {
            container.innerHTML = '<div style="text-align: center; color: #5e6c84; padding: 10px;">Nenhum chamado recente.</div>';
            return;
        }
        
        container.innerHTML = list.slice(0, 10).map(c => `
            <div class="list-item" onclick="openChamadoModal(${c.id})" style="cursor: pointer; transition: background 0.2s;">
                <div>
                     <div style="font-weight: 600; font-size: 0.9rem; color: #172b4d;">${c.titulo}</div>
                     <div style="font-size: 0.8rem; color: #5e6c84;">${c.protocolo} - <span class="status-badge status-${c.status_raw || 'aberto'}">${c.status}</span></div>
                </div>
                <div style="font-size: 0.8rem; color: #5e6c84;">${c.data_criacao}</div>
            </div>
        `).join('');
    }

    function renderPanelNFs(list) {
         const container = document.getElementById('panelNFsList');
        if(!list || list.length === 0) {
            container.innerHTML = '<div style="text-align: center; color: #5e6c84; padding: 10px;">Nenhuma nota fiscal recente.</div>';
            return;
        }

        container.innerHTML = list.slice(0, 5).map(n => `
            <div class="list-item">
                 <div>
                     <div style="font-weight: 500; font-size: 0.9rem;">Nota Fiscal</div>
                     <div style="font-size: 0.8rem; color: #5e6c84;">${n.data_envio}</div>
                </div>
                 <a href="${n.arquivo_url}" target="_blank" style="text-decoration: none; color: #0079bf; font-weight: 600; font-size: 0.85rem;">Baixar XML/PDF</a>
            </div>
        `).join('');
    }

    function startAction(type) {
        if(!currentSelectedClientId) return;
        
        // Setup modals with client pre-selected
        if(type === 'nf') {
            document.getElementById('nfCliente').value = currentSelectedClientId;
            openNFModal(); // Reuse existing
            document.getElementById('nfModal').style.zIndex = '2100'; // Higher than panel
        } else if (type === 'certidao') {
            document.getElementById('certidaoCliente').value = currentSelectedClientId;
            openCertidaoModal(); 
            document.getElementById('certidaoModal').style.zIndex = '2100';
        } else if (type === 'doc') {
             document.getElementById('docEmpresaCliente').value = currentSelectedClientId;
             openDocumentoEmpresaModal();
             document.getElementById('documentoEmpresaModal').style.zIndex = '2100';
        }
    }
    let currentData = [];
    let currentChamadoId = null;
    const API_BASE = '/support/api';

    // Navega√ß√£o do Menu (Disabled since UI removed)
    /*
    document.querySelectorAll('.menu-item').forEach(item => {
        item.addEventListener('click', function(e) {
             // ... logic disabled
        });
    });
    */

    // Fun√ß√£o para obter o CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');

    // Mostrar alert
    function showAlert(message, type = 'success') {
        const alertContainer = document.getElementById('alertContainer');
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type}`;
        alertDiv.innerHTML = `
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${type === 'success' ? 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' : 'M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'}"/>
            </svg>
            <span>${message}</span>
        `;
        alertContainer.appendChild(alertDiv);
        
        setTimeout(() => {
            alertDiv.remove();
        }, 5000);
    }

    // Navega√ß√£o do Menu
    document.querySelectorAll('.menu-item').forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            currentModel = this.dataset.model;
            loadModelData(currentModel);
        });
    });

    // Configura√ß√µes dos modelos
    const modelConfig = {
        clientes: {
            title: 'Gest√£o de Clientes',
            subtitle: 'Visualize e gerencie seus clientes ativos',
            endpoint: `${API_BASE}/clientes/`, // Backend updated previously
            btnText: 'Novo Cliente (Manual)',
            headers: []
        },
        leads: {
            title: 'Leads',
            subtitle: 'Gerencie todos os leads capturados do site',
            endpoint: `${API_BASE}/leads/`,
            btnText: 'Adicionar Novo Lead',
            headers: ['Nome', 'Email', 'Telefone', 'Cidade/Estado', 'Servi√ßo', 'Origem', 'Status', 'Data', 'A√ß√µes']
        },
        chamados: {
            title: 'Tickets de Suporte',
            subtitle: 'Gerencie os tickets de suporte dos clientes',
            endpoint: `${API_BASE}/chamados/`,
            btnText: null,
            headers: ['Protocolo', 'Cliente', 'Assunto', 'Status', 'Prioridade', 'Mensagens', 'Data', 'A√ß√µes']
        },
        'notas-fiscais': {
            title: 'Enviar Notas Fiscais',
            subtitle: 'Envie notas fiscais para os clientes',
            endpoint: null,
            btnText: 'Enviar Nova Nota Fiscal',
            headers: []
        },
        contabilidade: {
            title: 'Contabilidade',
            subtitle: 'Visualize as movimenta√ß√µes financeiras dos clientes',
            endpoint: null,
            btnText: null,
            headers: []
        },
        certidoes: {
            title: 'Certid√µes Negativas',
            subtitle: 'Envie certid√µes negativas para os clientes',
            endpoint: null,
            btnText: 'Enviar Nova Certid√£o',
            headers: []
        },
        'documentos-empresa': {
            title: 'Documentos da Empresa',
            subtitle: 'Envie documentos da empresa para os clientes',
            endpoint: null,
            btnText: 'Enviar Novo Documento',
            headers: []
        },
        'extratos-bancarios': {
            title: 'Extratos Banc√°rios',
            subtitle: 'Visualize os extratos banc√°rios enviados pelos clientes',
            endpoint: null,
            btnText: null,
            headers: []
        },
        testimonials: {
            title: 'Depoimentos',
            subtitle: 'Gerencie os depoimentos dos clientes',
            endpoint: `${API_BASE}/testimonials/`,
            btnText: 'Adicionar Depoimento',
            headers: ['Nome', 'Cargo', 'Conte√∫do', 'Status', 'Ordem', 'A√ß√µes']
        },
        posts: {
            title: 'Posts do Blog',
            subtitle: 'Gerencie os artigos do blog',
            endpoint: `${API_BASE}/posts/`,
            btnText: 'Adicionar Post',
            headers: ['T√≠tulo', 'Categoria', 'Autor', 'Status', 'Destaque', 'Data', 'A√ß√µes']
        },
        planos: {
            title: 'Planos',
            subtitle: 'Gerencie os planos de servi√ßo',
            endpoint: `${API_BASE}/planos/`,
            btnText: 'Adicionar Plano',
            headers: ['Nome', 'Categoria', 'Pre√ßo', 'Pre√ßo Antigo', 'Status', 'Destaque', 'A√ß√µes']
        },
        documents: {
            title: 'Documentos',
            subtitle: 'Gerencie os documentos dos clientes',
            endpoint: `${API_BASE}/documents/`,
            btnText: 'Enviar Documento',
            headers: ['T√≠tulo', 'Cliente', 'Categoria', 'Vis√≠vel', 'Data', 'A√ß√µes']
        }
    };

    // Carregar dados do modelo
    async function loadModelData(model) {
        const config = modelConfig[model];
        if (!config) return;

        document.getElementById('content-title').textContent = config.title;
        document.getElementById('content-subtitle').textContent = config.subtitle;
        
        const btnAddNew = document.getElementById('btnAddNew');
        
        // Configurar bot√£o de a√ß√£o
        if (config.btnText) {
            document.getElementById('btnAddNewText').textContent = config.btnText;
            btnAddNew.style.display = 'inline-flex';
            
            if (model === 'notas-fiscais') {
                btnAddNew.onclick = openNFModal;
            } else if (model === 'certidoes') {
                btnAddNew.onclick = openCertidaoModal;
            } else if (model === 'documentos-empresa') {
                btnAddNew.onclick = openDocumentoEmpresaModal;
            } else {
                btnAddNew.onclick = () => alert('Funcionalidade em desenvolvimento');
            }
        } else {
            btnAddNew.style.display = 'none';
        }

        // Para notas fiscais, mostrar interface customizada
        if (model === 'notas-fiscais') {
            renderNotasFiscaisInterface();
            return;
        }

        // Para clientes, mostrar Board customizada
        if (model === 'clientes') {
            const container = document.getElementById('dataCard');
            container.innerHTML = `
                <div style="padding: 40px; text-align: center;">
                    <div style="font-size: 24px; margin-bottom: 20px;">üîÑ Buscando clientes no sistema...</div>
                    <div style="max-width: 600px; margin: 0 auto; background: #f0f0f0; padding: 15px; border-radius: 8px; text-align: left; font-family: monospace;">
                        <div>Endpoint: ${config.endpoint}</div>
                        <div id="debug-status">Aguardando resposta...</div>
                    </div>
                </div>
            `;
            
            try {
                console.log('Fetching:', config.endpoint);
                const response = await fetch(config.endpoint);
                document.getElementById('debug-status').innerHTML += `<br>Status: ${response.status} ${response.statusText}`;
                
                if (!response.ok) {
                     throw new Error('Network response was not ok: ' + response.statusText);
                }
                
                // Get text first to debug if JSON is invalid
                const text = await response.text();
                // document.getElementById('debug-status').innerHTML += `<br>Raw length: ${text.length}`;
                
                let result;
                try {
                    result = JSON.parse(text);
                } catch(e) {
                    console.error("JSON Parse error", e);
                    document.getElementById('debug-status').innerHTML += `<br>JSON Parse Error: ${e.message}<br>Snippet: ${text.substring(0, 100)}...`;
                    throw e;
                }
                
                console.log('Result:', result);
                
                if (result.success) {
                    currentData = result.data;
                    document.getElementById('debug-status').innerHTML += `<br>Dados recebidos: ${currentData.length} registros. Renderizando...`;
                    renderClientsBoard();
                } else {
                    container.innerHTML = '<div style="color:red; padding:20px;">Erro na API: ' + JSON.stringify(result) + '</div>';
                }
            } catch (error) {
                console.error('Erro ao carregar clientes:', error);
                document.getElementById('dataCard').innerHTML += '<div style="color:red; padding:20px; font-weight:bold;">ERRO: ' + error.message + '</div>';
            }
            return;
        }
        
        // Para contabilidade, mostrar interface customizada
        if (model === 'contabilidade') {
            renderContabilidadeInterface();
            return;
        }
        
        // Para certid√µes, mostrar interface customizada
        if (model === 'certidoes') {
            renderCertidoesInterface();
            return;
        }
        
        // Para documentos da empresa, mostrar interface customizada
        if (model === 'documentos-empresa') {
            renderDocumentosEmpresaInterface();
            return;
        }
        
        // Para extratos banc√°rios, mostrar interface customizada
        if (model === 'extratos-bancarios') {
            renderExtratosBancariosInterface();
            return;
        }

        // Restaurar tabela se necess√°rio (caso tenha vindo de uma view customizada como Kanban ou Notas Fiscais)
        let thead = document.getElementById('tableHead');
        if (!thead) {
             const dataCard = document.getElementById('dataCard');
             dataCard.innerHTML = `
                <table class="data-table" id="dataTable">
                    <thead id="tableHead"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
             `;
             dataCard.className = 'data-card';
             dataCard.style.background = '';
             dataCard.style.boxShadow = '';
             thead = document.getElementById('tableHead');
        }

        // Renderizar headers
        thead.innerHTML = `<tr>${config.headers.map(h => `<th>${h}</th>`).join('')}</tr>`;

        try {
            const response = await fetch(config.endpoint);
            const result = await response.json();
            if (result.success) {
                currentData = result.data;
                renderTable();
                updateCounts();
            }
        } catch (error) {
            console.error('Erro ao carregar dados:', error);
            currentData = [];
            renderTable();
        }
    }

    // Renderizar interface de Notas Fiscais
    function renderNotasFiscaisInterface() {
        const dataCard = document.getElementById('dataCard');
        
        // Buscar hist√≥rico de notas fiscais
        fetch('/support/api/notas-fiscais/')
            .then(response => response.json())
            .then(result => {
                const notas = result.data || [];
                
                dataCard.innerHTML = `
                    <div style="padding: 32px;">
                        <!-- Card de Instru√ß√£o -->
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; padding: 32px; margin-bottom: 32px; color: white;">
                            <div style="display: flex; align-items: center; gap: 24px;">
                                <svg width="80" height="80" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink: 0; opacity: 0.9;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                <div>
                                    <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 8px;">Gerenciar Notas Fiscais</h3>
                                    <p style="opacity: 0.95; line-height: 1.6;">Clique em "Enviar Nova Nota Fiscal" no canto superior direito para fazer o upload de uma NF para um cliente. Os clientes poder√£o visualizar e baixar em suas √°reas.</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Hist√≥rico de NFs -->
                        <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                            <h4 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 20px; color: var(--text-primary);">
                                üìÑ Hist√≥rico de Notas Fiscais Enviadas
                            </h4>
                            
                            ${notas.length === 0 ? `
                                <div style="text-align: center; padding: 48px 24px;">
                                    <svg width="80" height="80" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin: 0 auto 16px; opacity: 0.2;">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                    <p style="color: var(--text-secondary); font-size: 1.125rem;">Nenhuma nota fiscal enviada ainda</p>
                                </div>
                            ` : `
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="border-bottom: 2px solid var(--border-color);">
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">Data/Hora</th>
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">Cliente</th>
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">Arquivo</th>
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">Enviado Por</th>
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">Observa√ß√µes</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${notas.map(nota => `
                                                <tr style="border-bottom: 1px solid var(--border-color);">
                                                    <td style="padding: 12px; color: var(--text-primary);">
                                                        <strong>${nota.data_upload}</strong>
                                                    </td>
                                                    <td style="padding: 12px;">
                                                        <div><strong style="color: var(--text-primary);">${nota.cliente}</strong></div>
                                                        <div style="font-size: 0.875rem; color: var(--text-secondary);">${nota.cliente_email}</div>
                                                    </td>
                                                    <td style="padding: 12px;">
                                                        <span style="background: #F3F4F6; padding: 4px 12px; border-radius: 6px; font-size: 0.875rem; font-family: monospace; color: var(--text-primary);">
                                                            ${nota.arquivo}
                                                        </span>
                                                    </td>
                                                    <td style="padding: 12px; color: var(--text-primary);">
                                                        ${nota.enviado_por}
                                                    </td>
                                                    <td style="padding: 12px; color: var(--text-secondary); font-size: 0.875rem;">
                                                        ${nota.observacoes || '<em>Sem observa√ß√µes</em>'}
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            })
            .catch(error => {
                console.error('Erro ao carregar hist√≥rico de notas fiscais:', error);
                dataCard.innerHTML = `
                    <div style="padding: 48px; text-align: center;">
                        <p style="color: var(--danger-color);">Erro ao carregar hist√≥rico de notas fiscais</p>
                    </div>
                `;
            });
    }

    // Renderizar interface de Contabilidade
    function renderContabilidadeInterface() {
        const dataCard = document.getElementById('dataCard');
        
        // Buscar clientes com movimenta√ß√µes
        fetch('/support/api/contabilidade/clientes/')
            .then(response => response.json())
            .then(result => {
                const clientes = result.data || [];
                
                dataCard.innerHTML = `
                    <div style="padding: 32px;">
                        <!-- Card de Sele√ß√£o de Cliente -->
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; padding: 32px; margin-bottom: 32px; color: white;">
                            <div style="display: flex; align-items: center; gap: 24px;">
                                <svg width="80" height="80" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink: 0; opacity: 0.9;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                                </svg>
                                <div style="flex: 1;">
                                    <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 8px;">Contabilidade - Movimenta√ß√µes Financeiras</h3>
                                    <p style="opacity: 0.95; line-height: 1.6; margin-bottom: 24px;">Selecione um cliente e opcionalmente filtre por m√™s espec√≠fico.</p>
                                    
                                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 12px;">
                                        <select id="clienteContabilidade" style="width: 100%; padding: 12px 16px; border-radius: 8px; border: none; font-size: 1rem; color: #1F2937;">
                                            <option value="">Selecione um cliente...</option>
                                            ${clientes.map(c => `<option value="${c.id}">${c.nome} - ${c.cpf_cnpj} (${c.total_movimentacoes} movimenta√ß√µes)</option>`).join('')}
                                        </select>
                                        
                                        <select id="filtroMes" style="width: 100%; padding: 12px 16px; border-radius: 8px; border: none; font-size: 1rem; color: #1F2937;" disabled>
                                            <option value="">Todos os meses</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- √Årea de Movimenta√ß√µes -->
                        <div id="movimentacoesArea"></div>
                    </div>
                `;
                
                // Adicionar evento de mudan√ßa no select de cliente
                document.getElementById('clienteContabilidade').addEventListener('change', function() {
                    const clienteId = this.value;
                    const filtroMes = document.getElementById('filtroMes');
                    
                    if (clienteId) {
                        filtroMes.disabled = false;
                        carregarMovimentacoes(clienteId);
                    } else {
                        filtroMes.disabled = true;
                        filtroMes.innerHTML = '<option value="">Todos os meses</option>';
                        document.getElementById('movimentacoesArea').innerHTML = '';
                    }
                });
                
                // Adicionar evento de mudan√ßa no filtro de m√™s
                document.getElementById('filtroMes').addEventListener('change', function() {
                    const clienteId = document.getElementById('clienteContabilidade').value;
                    if (clienteId) {
                        carregarMovimentacoes(clienteId);
                    }
                });
            })
            .catch(error => {
                console.error('Erro ao carregar clientes:', error);
                dataCard.innerHTML = `
                    <div style="padding: 48px; text-align: center;">
                        <p style="color: var(--danger-color);">Erro ao carregar lista de clientes</p>
                    </div>
                `;
            });
    }

    // Carregar movimenta√ß√µes de um cliente
    function carregarMovimentacoes(clienteId) {
        const movimentacoesArea = document.getElementById('movimentacoesArea');
        movimentacoesArea.innerHTML = '<div style="text-align: center; padding: 40px;"><div class="spinner"></div><p style="margin-top: 16px; color: var(--text-secondary);">Carregando movimenta√ß√µes...</p></div>';
        
        fetch(`/support/api/contabilidade/clientes/${clienteId}/movimentacoes/`)
            .then(response => response.json())
            .then(result => {
                if (!result.success) {
                    movimentacoesArea.innerHTML = '<p style="color: var(--danger-color); text-align: center;">Erro ao carregar movimenta√ß√µes</p>';
                    return;
                }
                
                const cliente = result.cliente;
                const todosMeses = result.data;
                
                // Atualizar o filtro de meses na primeira carga
                const filtroMes = document.getElementById('filtroMes');
                const mesAtualSelecionado = filtroMes.value;
                
                if (filtroMes.options.length === 1) { // Primeira carga
                    filtroMes.innerHTML = '<option value="">Todos os meses</option>' +
                        todosMeses.map(m => `<option value="${m.mes_ano}">${m.mes_ano_formatado}</option>`).join('');
                }
                
                // Filtrar meses se houver filtro selecionado
                const mesFiltrado = filtroMes.value;
                const meses = mesFiltrado ? todosMeses.filter(m => m.mes_ano === mesFiltrado) : todosMeses;
                
                if (meses.length === 0) {
                    const mensagem = mesFiltrado ? 'Nenhuma movimenta√ß√£o encontrada para este m√™s' : 'Nenhuma movimenta√ß√£o encontrada para este cliente';
                    movimentacoesArea.innerHTML = `
                        <div style="text-align: center; padding: 48px; background: white; border-radius: 12px;">
                            <svg width="80" height="80" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin: 0 auto 16px; opacity: 0.2;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                            </svg>
                            <p style="color: var(--text-secondary); font-size: 1.125rem;">${mensagem}</p>
                        </div>
                    `;
                    return;
                }
                
                // Calcular totais gerais (considerando o filtro)
                const totaisGerais = meses.reduce((acc, mes) => {
                    acc.receitas += mes.total_receitas;
                    acc.despesas += mes.total_despesas;
                    acc.saldo += mes.saldo;
                    return acc;
                }, { receitas: 0, despesas: 0, saldo: 0 });
                
                const formatarValor = (valor) => `R$ ${valor.toFixed(2)}`.replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                
                // Renderizar movimenta√ß√µes agrupadas por m√™s
                movimentacoesArea.innerHTML = `
                    <!-- Informa√ß√µes do Cliente -->
                    <div style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                            <div>
                                <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 12px; color: var(--text-primary);">
                                    üë§ ${cliente.nome}
                                </h3>
                                <div style="display: flex; gap: 32px; color: var(--text-secondary);">
                                    <div><strong>Email:</strong> ${cliente.email}</div>
                                    <div><strong>CPF/CNPJ:</strong> ${cliente.cpf_cnpj}</div>
                                </div>
                            </div>
                            ${mesFiltrado ? '' : `
                                <div style="background: #F9FAFB; border-radius: 12px; padding: 16px; min-width: 280px;">
                                    <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 8px; text-align: center;">üí∞ Resumo Geral</div>
                                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; text-align: center;">
                                        <div>
                                            <div style="font-size: 0.75rem; color: var(--text-secondary);">Receitas</div>
                                            <div style="font-weight: 700; color: #10B981; font-size: 0.875rem;">${formatarValor(totaisGerais.receitas)}</div>
                                        </div>
                                        <div>
                                            <div style="font-size: 0.75rem; color: var(--text-secondary);">Despesas</div>
                                            <div style="font-weight: 700; color: #EF4444; font-size: 0.875rem;">${formatarValor(totaisGerais.despesas)}</div>
                                        </div>
                                        <div>
                                            <div style="font-size: 0.75rem; color: var(--text-secondary);">Saldo</div>
                                            <div style="font-weight: 700; color: ${totaisGerais.saldo >= 0 ? '#10B981' : '#EF4444'}; font-size: 0.875rem;">${formatarValor(totaisGerais.saldo)}</div>
                                        </div>
                                    </div>
                                </div>
                            `}
                        </div>
                    </div>
                    
                    <!-- Movimenta√ß√µes por M√™s -->
                    ${meses.map((mes, index) => `
                        <div style="background: white; border-radius: 12px; margin-bottom: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden;">
                            <!-- Header do M√™s -->
                            <div style="background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); padding: 20px 24px; cursor: pointer;" onclick="toggleMes('mes-${index}')">
                                <div style="display: flex; justify-content: space-between; align-items: center; color: white;">
                                    <div>
                                        <h4 style="font-size: 1.125rem; font-weight: 700; margin-bottom: 8px;">üìÖ ${mes.mes_ano_formatado}</h4>
                                        <div style="opacity: 0.95; font-size: 0.875rem;">
                                            ${mes.movimentacoes.length} movimenta√ß√µes
                                        </div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 4px;">Saldo do M√™s</div>
                                        <div style="font-size: 1.5rem; font-weight: 700;" class="${mes.saldo >= 0 ? 'text-success' : 'text-danger'}">
                                            ${mes.saldo_formatado}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Conte√∫do do M√™s -->
                            <div id="mes-${index}" style="display: block;">
                                <!-- Resumo -->
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; padding: 20px 24px; background: #F9FAFB; border-bottom: 1px solid var(--border-color);">
                                    <div>
                                        <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 4px;">Total Receitas</div>
                                        <div style="font-size: 1.25rem; font-weight: 700; color: #10B981;">${mes.total_receitas_formatado}</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 4px;">Total Despesas</div>
                                        <div style="font-size: 1.25rem; font-weight: 700; color: #EF4444;">${mes.total_despesas_formatado}</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 4px;">Saldo</div>
                                        <div style="font-size: 1.25rem; font-weight: 700; color: ${mes.saldo >= 0 ? '#10B981' : '#EF4444'};">${mes.saldo_formatado}</div>
                                    </div>
                                </div>
                                
                                <!-- Tabela de Movimenta√ß√µes -->
                                <div style="padding: 24px;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="border-bottom: 2px solid var(--border-color);">
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">Tipo</th>
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">Descri√ß√£o</th>
                                                <th style="padding: 12px; text-align: right; font-weight: 600; color: var(--text-secondary);">Valor</th>
                                                <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-secondary);">Status</th>
                                                <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-secondary);">Anexo</th>
                                                <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-secondary);">Data Envio</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${mes.movimentacoes.map(mov => `
                                                <tr style="border-bottom: 1px solid var(--border-color);">
                                                    <td style="padding: 12px;">
                                                        <span class="badge ${mov.tipo_raw === 'receita' ? 'badge-success' : 'badge-danger'}">
                                                            ${mov.tipo_raw === 'receita' ? '‚¨ÜÔ∏è' : '‚¨áÔ∏è'} ${mov.tipo}
                                                        </span>
                                                    </td>
                                                    <td style="padding: 12px; font-weight: 600; color: var(--text-primary);">${mov.nome}</td>
                                                    <td style="padding: 12px; text-align: right; font-weight: 700; color: ${mov.tipo_raw === 'receita' ? '#10B981' : '#EF4444'};">
                                                        ${mov.valor_formatado}
                                                    </td>
                                                    <td style="padding: 12px; text-align: center;">
                                                        <span class="badge badge-info">${mov.status}</span>
                                                    </td>
                                                    <td style="padding: 12px; text-align: center;">
                                                        ${mov.anexo_url ? `<a href="${mov.anexo_url}" target="_blank" style="color: var(--primary-color);">üìé Ver</a>` : '<span style="color: var(--text-secondary);">-</span>'}
                                                    </td>
                                                    <td style="padding: 12px; text-align: center; color: var(--text-secondary); font-size: 0.875rem;">
                                                        ${mov.data_criacao}
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                `;
            })
            .catch(error => {
                console.error('Erro ao carregar movimenta√ß√µes:', error);
                movimentacoesArea.innerHTML = '<p style="color: var(--danger-color); text-align: center;">Erro ao carregar movimenta√ß√µes</p>';
            });
    }

    // Toggle accordion de m√™s
    function toggleMes(mesId) {
        const elemento = document.getElementById(mesId);
        if (elemento.style.display === 'none') {
            elemento.style.display = 'block';
        } else {
            elemento.style.display = 'none';
        }
    }

    // Renderizar interface de Extratos Banc√°rios
    function renderExtratosBancariosInterface() {
        const dataCard = document.getElementById('dataCard');
        
        // Buscar clientes com extratos
        fetch('/support/api/extratos-bancarios/clientes/')
            .then(response => response.json())
            .then(result => {
                const clientes = result.data || [];
                
                dataCard.innerHTML = `
                    <div style="padding: 32px;">
                        <!-- Card de Sele√ß√£o de Cliente -->
                        <div style="background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); border-radius: 16px; padding: 32px; margin-bottom: 32px; color: white;">
                            <div style="display: flex; align-items: center; gap: 24px;">
                                <svg width="80" height="80" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink: 0; opacity: 0.9;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                                </svg>
                                <div style="flex: 1;">
                                    <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 8px;">Extratos Banc√°rios dos Clientes</h3>
                                    <p style="opacity: 0.95; line-height: 1.6; margin-bottom: 24px;">Selecione um cliente abaixo para visualizar todos os extratos banc√°rios que ele enviou.</p>
                                    
                                    <select id="clienteExtrato" style="width: 100%; padding: 12px 16px; border-radius: 8px; border: none; font-size: 1rem; color: #1F2937;">
                                        <option value="">Selecione um cliente...</option>
                                        ${clientes.map(c => `<option value="${c.id}">${c.nome} - ${c.email} (${c.total_extratos} extrato${c.total_extratos !== 1 ? 's' : ''})</option>`).join('')}
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- √Årea de Extratos -->
                        <div id="extratosArea"></div>
                    </div>
                `;
                
                // Adicionar evento de mudan√ßa no select
                document.getElementById('clienteExtrato').addEventListener('change', function() {
                    const clienteId = this.value;
                    if (clienteId) {
                        carregarExtratos(clienteId);
                    } else {
                        document.getElementById('extratosArea').innerHTML = '';
                    }
                });
            })
            .catch(error => {
                console.error('Erro ao carregar clientes:', error);
                dataCard.innerHTML = `
                    <div style="padding: 48px; text-align: center;">
                        <p style="color: var(--danger-color);">Erro ao carregar lista de clientes</p>
                    </div>
                `;
            });
    }

    // Carregar extratos de um cliente
    function carregarExtratos(clienteId) {
        const extratosArea = document.getElementById('extratosArea');
        extratosArea.innerHTML = '<div style="text-align: center; padding: 40px;"><div class="spinner"></div><p style="margin-top: 16px; color: var(--text-secondary);">Carregando extratos...</p></div>';
        
        fetch(`/support/api/extratos-bancarios/clientes/${clienteId}/`)
            .then(response => response.json())
            .then(result => {
                if (!result.success) {
                    extratosArea.innerHTML = '<p style="color: var(--danger-color); text-align: center;">Erro ao carregar extratos</p>';
                    return;
                }
                
                const cliente = result.cliente;
                const extratos = result.data;
                
                if (extratos.length === 0) {
                    extratosArea.innerHTML = `
                        <div style="text-align: center; padding: 48px; background: white; border-radius: 12px;">
                            <svg width="80" height="80" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin: 0 auto 16px; opacity: 0.2;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                            </svg>
                            <p style="color: var(--text-secondary); font-size: 1.125rem;">Nenhum extrato banc√°rio enviado por este cliente</p>
                        </div>
                    `;
                    return;
                }
                
                // Renderizar extratos
                extratosArea.innerHTML = `
                    <!-- Informa√ß√µes do Cliente -->
                    <div style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 12px; color: var(--text-primary);">
                            üë§ ${cliente.nome}
                        </h3>
                        <div style="display: flex; gap: 32px; color: var(--text-secondary);">
                            <div><strong>Email:</strong> ${cliente.email}</div>
                            <div><strong>Total de Extratos:</strong> ${extratos.length}</div>
                        </div>
                    </div>
                    
                    <!-- Lista de Extratos -->
                    <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <h4 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 20px; color: var(--text-primary);">
                            üí≥ Extratos Banc√°rios Enviados
                        </h4>
                        
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="border-bottom: 2px solid var(--border-color);">
                                        <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">Data Upload</th>
                                        <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-secondary);">M√™s/Ano</th>
                                        <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-secondary);">Per√≠odo</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">Arquivo</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">Observa√ß√µes</th>
                                        <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-secondary);">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${extratos.map(extrato => `
                                        <tr style="border-bottom: 1px solid var(--border-color);">
                                            <td style="padding: 12px; color: var(--text-primary);">
                                                <strong>${extrato.data_upload}</strong>
                                            </td>
                                            <td style="padding: 12px; text-align: center;">
                                                <span class="badge badge-info" style="font-size: 0.875rem;">${extrato.mes_ano}</span>
                                            </td>
                                            <td style="padding: 12px; text-align: center; font-size: 0.875rem; color: var(--text-secondary);">
                                                ${extrato.start_date && extrato.end_date 
                                                    ? `${extrato.start_date} a ${extrato.end_date}` 
                                                    : '-'
                                                }
                                            </td>
                                            <td style="padding: 12px;">
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <span class="badge badge-secondary" style="font-size: 0.75rem;">${extrato.extensao}</span>
                                                    <span style="font-size: 0.875rem; color: var(--text-primary);">${extrato.nome_arquivo}</span>
                                                </div>
                                                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 4px;">${extrato.tamanho}</div>
                                            </td>
                                            <td style="padding: 12px; font-size: 0.875rem; color: var(--text-secondary); max-width: 200px;">
                                                ${extrato.observacoes || '<em style="color: var(--text-secondary);">Sem observa√ß√µes</em>'}
                                            </td>
                                            <td style="padding: 12px; text-align: center;">
                                                ${extrato.arquivo_url ? `
                                                    <a href="${extrato.arquivo_url}" target="_blank" 
                                                       style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: var(--primary-color); color: white; text-decoration: none; border-radius: 6px; font-size: 0.875rem;">
                                                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                                        </svg>
                                                        Visualizar
                                                    </a>
                                                    <a href="${extrato.arquivo_url}" download 
                                                       style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: var(--success-color); color: white; text-decoration: none; border-radius: 6px; font-size: 0.875rem; margin-left: 8px;">
                                                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                                        </svg>
                                                        Baixar
                                                    </a>
                                                ` : '<span style="color: var(--text-secondary);">-</span>'}
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            })
            .catch(error => {
                console.error('Erro ao carregar extratos:', error);
                extratosArea.innerHTML = '<p style="color: var(--danger-color); text-align: center;">Erro ao carregar extratos</p>';
            });
    }

    // Renderizar interface de Documentos da Empresa
    function renderDocumentosEmpresaInterface() {
        const dataCard = document.getElementById('dataCard');
        
        // Buscar hist√≥rico de documentos e clientes
        Promise.all([
            fetch('/support/api/documentos-empresa/').then(r => r.json()),
            fetch('/support/api/clientes-fase/').then(r => r.json())
        ])
        .then(([docsResult, clientesResult]) => {
            const documentos = docsResult.data || [];
            const clientes = clientesResult.data || [];
            
            dataCard.innerHTML = `
                <div style="padding: 32px;">
                    <!-- Card de Instru√ß√£o -->
                    <div style="background: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%); border-radius: 16px; padding: 32px; margin-bottom: 32px; color: white;">
                        <div style="display: flex; align-items: center; gap: 24px;">
                            <svg width="80" height="80" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink: 0; opacity: 0.9;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"/>
                            </svg>
                            <div>
                                <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 8px;">Gerenciar Documentos da Empresa</h3>
                                <p style="opacity: 0.95; line-height: 1.6;">Envie documentos importantes como Contratos, Alvar√°s, Certid√µes e outros para os clientes. Eles visualizam em "Minha Empresa".</p>
                            </div>
                        </div>
                    </div>

                    <!-- Gerenciar Fase de Abertura -->
                    <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 32px;">
                        <h4 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 20px; color: var(--text-primary);">
                            üöÄ Gerenciar Fase de Abertura
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 16px; align-items: end;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary);">Cliente</label>
                                <select id="faseClienteSelect" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                                    <option value="">Selecione um cliente...</option>
                                    ${clientes.map(c => `<option value="${c.id}" data-fase="${c.fase_abertura}">${c.nome} (${c.email})</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary);">Fase Atual</label>
                                <select id="faseSelect" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
                                    <option value="fase_1">Fase 1 ‚Äî Planejamento e An√°lise Inicial</option>
                                    <option value="fase_2">Fase 2 ‚Äî Consulta de Viabilidade</option>
                                    <option value="fase_3">Fase 3 ‚Äî Registro Jur√≠dico</option>
                                    <option value="fase_4">Fase 4 ‚Äî Inscri√ß√µes Fiscais</option>
                                    <option value="fase_5">Fase 5 ‚Äî Licen√ßas e Autoriza√ß√µes</option>
                                    <option value="fase_6">Fase 6 ‚Äî Enquadramento Tribut√°rio</option>
                                    <option value="fase_7">Fase 7 ‚Äî Empresa Aberta</option>
                                </select>
                            </div>
                            <button onclick="updateFaseAbertura()" style="padding: 10px 24px; background-color: var(--primary-color); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                                Atualizar Fase
                            </button>
                        </div>
                    </div>
                    
                    <!-- Hist√≥rico de Documentos -->
                    <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <h4 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 20px; color: var(--text-primary);">
                            üìÑ Hist√≥rico de Documentos Enviados
                        </h4>
                        
                        ${documentos.length === 0 ? `
                            <div style="text-align: center; padding: 48px 24px;">
                                <svg width="80" height="80" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin: 0 auto 16px; opacity: 0.2;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"/>
                                </svg>
                                <p style="color: var(--text-secondary); font-size: 1.125rem;">Nenhum documento enviado ainda</p>
                            </div>
                        ` : `
                            <div style="overflow-x: auto;">
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr style="border-bottom: 2px solid var(--border-color);">
                                            <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">Data/Hora</th>
                                            <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">Cliente</th>
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">T√≠tulo</th>
                                                <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-secondary);">Categoria</th>
                                                <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-secondary);">Arquivo</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${documentos.map(doc => `
                                                <tr style="border-bottom: 1px solid var(--border-color);">
                                                    <td style="padding: 12px; color: var(--text-primary);">
                                                        <strong>${doc.data_upload}</strong>
                                                    </td>
                                                    <td style="padding: 12px;">
                                                        <div><strong style="color: var(--text-primary);">${doc.cliente}</strong></div>
                                                        <div style="font-size: 0.875rem; color: var(--text-secondary);">${doc.cliente_email}</div>
                                                    </td>
                                                    <td style="padding: 12px;">
                                                        <div style="font-weight: 600; color: var(--text-primary);">${doc.titulo}</div>
                                                        ${doc.descricao ? `<div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 4px;">${doc.descricao}</div>` : ''}
                                                    </td>
                                                    <td style="padding: 12px; text-align: center;">
                                                        <span class="badge badge-info">${doc.categoria}</span>
                                                    </td>
                                                    <td style="padding: 12px; text-align: center;">
                                                        <div style="margin-bottom: 4px;">
                                                            <span style="background: #F3F4F6; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-family: monospace;">
                                                                ${doc.nome_arquivo}
                                                            </span>
                                                        </div>
                                                        <div style="font-size: 0.75rem; color: var(--text-secondary);">${doc.tamanho}</div>
                                                        ${doc.arquivo_url ? `<a href="${doc.arquivo_url}" target="_blank" style="color: var(--primary-color); text-decoration: none; font-size: 0.875rem;">üì• Baixar</a>` : ''}
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            `}
                        </div>
                    </div>
                `;
                
                // Add event listener for client select
                const faseClienteSelect = document.getElementById('faseClienteSelect');
                const faseSelect = document.getElementById('faseSelect');
                
                if (faseClienteSelect && faseSelect) {
                    faseClienteSelect.addEventListener('change', function() {
                        const selectedOption = this.options[this.selectedIndex];
                        const currentFase = selectedOption.getAttribute('data-fase');
                        if (currentFase) {
                            faseSelect.value = currentFase;
                        }
                    });
                }
            })
            .catch(error => {
                console.error('Erro ao carregar hist√≥rico de documentos:', error);
                dataCard.innerHTML = `
                    <div style="padding: 48px; text-align: center;">
                        <p style="color: var(--danger-color);">Erro ao carregar hist√≥rico de documentos</p>
                    </div>
                `;
            });
    }

    // Fun√ß√£o para atualizar a fase de abertura
    function updateFaseAbertura() {
        const clienteId = document.getElementById('faseClienteSelect').value;
        const fase = document.getElementById('faseSelect').value;
        
        if (!clienteId) {
            alert('Por favor, selecione um cliente.');
            return;
        }
        
        fetch('/support/api/clientes-fase/update/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                cliente_id: clienteId,
                fase: fase
            })
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                alert(result.message);
                // Atualizar o atributo data-fase no select
                const option = document.querySelector(`#faseClienteSelect option[value="${clienteId}"]`);
                if (option) {
                    option.setAttribute('data-fase', fase);
                }
            } else {
                alert('Erro ao atualizar fase: ' + result.error);
            }
        })
        .catch(error => {
            console.error('Erro:', error);
            alert('Erro ao atualizar fase.');
        });
    }

    // Renderizar interface de Certid√µes Negativas
    function renderCertidoesInterface() {
        const dataCard = document.getElementById('dataCard');
        
        // Buscar hist√≥rico de certid√µes
        fetch('/support/api/certidoes/')
            .then(response => response.json())
            .then(result => {
                const certidoes = result.data || [];
                
                dataCard.innerHTML = `
                    <div style="padding: 32px;">
                        <!-- Card de Instru√ß√£o -->
                        <div style="background: linear-gradient(135deg, #10B981 0%, #059669 100%); border-radius: 16px; padding: 32px; margin-bottom: 32px; color: white;">
                            <div style="display: flex; align-items: center; gap: 24px;">
                                <svg width="80" height="80" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink: 0; opacity: 0.9;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                </svg>
                                <div>
                                    <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 8px;">Gerenciar Certid√µes Negativas</h3>
                                    <p style="opacity: 0.95; line-height: 1.6;">Clique em "Enviar Nova Certid√£o" para selecionar um cliente e enviar uma certid√£o (Federal, Estadual, Trabalhista ou FGTS). Os clientes visualizam as certid√µes em sua √°rea de pend√™ncias.</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Hist√≥rico de Certid√µes -->
                        <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                            <h4 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 20px; color: var(--text-primary);">
                                üõ°Ô∏è Hist√≥rico de Certid√µes Enviadas
                            </h4>
                            
                            ${certidoes.length === 0 ? `
                                <div style="text-align: center; padding: 48px 24px;">
                                    <svg width="80" height="80" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin: 0 auto 16px; opacity: 0.2;">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                    </svg>
                                    <p style="color: var(--text-secondary); font-size: 1.125rem;">Nenhuma certid√£o enviada ainda</p>
                                </div>
                            ` : `
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="border-bottom: 2px solid var(--border-color);">
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">Data/Hora</th>
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">Cliente</th>
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-secondary);">Tipo de Certid√£o</th>
                                                <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-secondary);">Status</th>
                                                <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-secondary);">Arquivo</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${certidoes.map(cert => `
                                                <tr style="border-bottom: 1px solid var(--border-color);">
                                                    <td style="padding: 12px; color: var(--text-primary);">
                                                        <strong>${cert.data_envio}</strong>
                                                    </td>
                                                    <td style="padding: 12px;">
                                                        <div><strong style="color: var(--text-primary);">${cert.cliente}</strong></div>
                                                        <div style="font-size: 0.875rem; color: var(--text-secondary);">${cert.cliente_email}</div>
                                                    </td>
                                                    <td style="padding: 12px;">
                                                        <span class="badge ${
                                                            cert.tipo_raw === 'federal' ? 'badge-primary' : 
                                                            cert.tipo_raw === 'estadual' ? 'badge-info' :
                                                            cert.tipo_raw === 'trabalhista' ? 'badge-warning' :
                                                            'badge-success'
                                                        }">
                                                            ${cert.tipo}
                                                        </span>
                                                    </td>
                                                    <td style="padding: 12px; text-align: center;">
                                                        <span class="badge ${
                                                            cert.status_raw === 'negativa' ? 'badge-success' :
                                                            cert.status_raw === 'positiva' ? 'badge-danger' :
                                                            'badge-secondary'
                                                        }">
                                                            ${cert.status}
                                                        </span>
                                                    </td>
                                                    <td style="padding: 12px; text-align: center;">
                                                        ${cert.arquivo_url ? `<a href="${cert.arquivo_url}" target="_blank" style="color: var(--primary-color); text-decoration: none;">üìÑ Baixar</a>` : '-'}
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            })
            .catch(error => {
                console.error('Erro ao carregar hist√≥rico de certid√µes:', error);
                dataCard.innerHTML = `
                    <div style="padding: 48px; text-align: center;">
                        <p style="color: var(--danger-color);">Erro ao carregar hist√≥rico de certid√µes</p>
                    </div>
                `;
            });
    }

    // Renderizar tabela
    // === KANBAN FUNCTIONS ===
    
    function renderChamadosBoard() {
        const container = document.getElementById('dataCard');
        container.innerHTML = '';
        container.classList.remove('data-card');
        container.style.background = 'transparent';
        container.style.boxShadow = 'none';

        const columns = [
            { id: 'aberto', title: 'Novos Chamados', color: '#EF4444' },
            { id: 'em_andamento', title: 'Em An√°lise', color: '#F59E0B' },
            { id: 'resolvido', title: 'Resolvido', color: '#10B981' },
            { id: 'fechado', title: 'Fechado', color: '#6B7280' }
        ];

        const board = document.createElement('div');
        board.className = 'kanban-container';

        columns.forEach(col => {
            // Filter items for this column
            const colItems = currentData.filter(item => {
                 if (item.status_value) return item.status_value === col.id;
                 const s = item.status ? item.status.toLowerCase() : '';
                 if (col.id === 'aberto' && s.includes('aberto')) return true;
                 if (col.id === 'em_andamento' && (s.includes('andamento') || s.includes('an√°lise'))) return true;
                 if (col.id === 'resolvido' && (s.includes('resolvido') || s.includes('conclu√≠do'))) return true;
                 if (col.id === 'fechado' && s.includes('fechado')) return true;
                 return false;
            });
            
            const colDiv = document.createElement('div');
            colDiv.className = 'kanban-column';
            colDiv.dataset.status = col.id;
            
            colDiv.innerHTML = `
                <div class="kanban-column-header" style="border-top-color: ${col.color}">
                    <h3 class="kanban-column-title">${col.title}</h3>
                    <span class="kanban-column-count">${colItems.length}</span>
                </div>
                <div class="kanban-column-content" ondrop="kanbanDrop(event)" ondragover="kanbanAllowDrop(event)" data-status="${col.id}">
                    ${colItems.map(item => createCardHTML(item)).join('')}
                </div>
            `;
            board.appendChild(colDiv);
        });

        container.appendChild(board);
        
        document.querySelectorAll('.kanban-card').forEach(card => {
            card.addEventListener('dragstart', kanbanDrag);
            card.addEventListener('click', (e) => {
                viewChamado(card.dataset.id);
            });
        });
    }

    function createCardHTML(item) {
        let priorityClass = 'media';
        if (item.prioridade_value) priorityClass = item.prioridade_value;
        else if (item.prioridade) {
             const p = item.prioridade.toLowerCase();
             if (p.includes('baixa')) priorityClass = 'baixa';
             if (p.includes('alta')) priorityClass = 'alta';
             if (p.includes('urgente')) priorityClass = 'urgente';
        }

        const dateStr = item.data_criacao ? item.data_criacao.split(' ')[0] : '';

        return `
            <div class="kanban-card" id="card-${item.id}" draggable="true" data-id="${item.id}">
                <div class="kanban-card-header">
                    <span class="kanban-card-protocol">${item.protocolo || '#' + item.id}</span>
                    <span class="kanban-card-priority ${priorityClass}">${item.prioridade || 'M√©dia'}</span>
                </div>
                <div class="kanban-card-title">${item.titulo}</div>
                <div class="kanban-card-client">
                    <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    ${item.cliente || 'Desconhecido'}
                </div>
                <div class="kanban-card-footer">
                    <span class="kanban-card-date">
                        <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        ${dateStr}
                    </span>
                    <span class="kanban-card-msgs" style="display: flex; align-items: center; gap: 4px;">
                        <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                        </svg>
                        ${item.mensagens_count || 0}
                    </span>
                </div>
            </div>
        `;
    }

    function kanbanAllowDrop(ev) {
        ev.preventDefault();
        ev.dataTransfer.dropEffect = "move";
    }

    function kanbanDrag(ev) {
        ev.dataTransfer.setData("text/plain", ev.target.id);
        ev.target.classList.add('dragging');
    }

    async function kanbanDrop(ev) {
        ev.preventDefault();
        const data = ev.dataTransfer.getData("text/plain");
        const card = document.getElementById(data);
        if (!card) return;
        
        card.classList.remove('dragging');
        
        let target = ev.target;
        while (target && !target.classList.contains('kanban-column-content')) {
            target = target.parentElement;
        }
        
        if (target && target !== card.parentElement) {
            target.appendChild(card);
            const newStatus = target.dataset.status;
            const cardId = card.dataset.id;
            
            updateColumnCounts();

            try {
                const response = await fetch(`${API_BASE}/chamados/${cardId}/update-status/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    },
                    body: JSON.stringify({ status: newStatus })
                });
                const result = await response.json();
                
                if (result.success) {
                    const item = currentData.find(i => i.id == cardId);
                    if(item) {
                        item.status_value = newStatus;
                        item.status = result.status_display; 
                    }
                } else {
                    showAlert('Erro ao atualizar status: ' + (result.error || 'Erro desconhecido'), 'error');
                    loadModelData('chamados');
                }
            } catch (e) {
                console.error(e);
                showAlert('Erro de conex√£o', 'error');
                loadModelData('chamados');
            }
        }
    }

    function updateColumnCounts() {
        document.querySelectorAll('.kanban-column').forEach(col => {
            const count = col.querySelectorAll('.kanban-card').length;
            col.querySelector('.kanban-column-count').textContent = count;
        });
    }

    function renderTable() {
        if (currentModel === 'chamados') {
            renderChamadosBoard();
            return;
        }
        const tbody = document.getElementById('tableBody');
        const config = modelConfig[currentModel];
        
        if (currentData.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="${config.headers.length}">
                        <div class="empty-state">
                            <svg class="empty-state-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                            </svg>
                            <h3 class="empty-state-title">Nenhum registro encontrado</h3>
                            <p class="empty-state-text">Clique em "${config.btnText}" para criar o primeiro registro</p>
                        </div>
                    </td>
                </tr>
            `;
            return;
        }

        // Renderizar baseado no modelo atual
        if (currentModel === 'leads') {
            tbody.innerHTML = currentData.map(item => `
                <tr>
                    <td>${item.nome_completo}</td>
                    <td>${item.email}</td>
                    <td>${item.telefone}</td>
                    <td>${item.cidade}/${item.estado}</td>
                    <td>${item.servico_interesse}</td>
                    <td><span class="badge badge-info">${item.origem}</span></td>
                    <td>
                        ${item.contatado 
                            ? '<span class="badge badge-success">Contatado</span>' 
                            : '<span class="badge badge-warning">Pendente</span>'
                        }
                    </td>
                    <td>${new Date(item.criado_em).toLocaleDateString('pt-BR')}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-whatsapp" onclick="sendWhatsApp('${item.nome_completo}', '${item.telefone}', '${item.servico_interesse}')" title="Abrir WhatsApp Web">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        } else if (currentModel === 'chamados') {
            tbody.innerHTML = currentData.map(item => `
                <tr>
                    <td><strong>${item.protocolo}</strong></td>
                    <td>
                        <div><strong>${item.cliente}</strong></div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">${item.cliente_email}</div>
                    </td>
                    <td>${item.titulo}</td>
                    <td><span class="badge badge-info">${item.status}</span></td>
                    <td><span class="badge badge-warning">${item.prioridade}</span></td>
                    <td><span class="badge badge-success">${item.mensagens_count}</span></td>
                    <td>${item.data_criacao}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-view" onclick="viewChamado(${item.id})">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                                Ver Detalhes
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        } else if (currentModel === 'posts') {
            tbody.innerHTML = currentData.map(item => `
                <tr>
                    <td>${item.title}</td>
                    <td>${item.category}</td>
                    <td>${item.author}</td>
                    <td><span class="badge badge-info">${item.status}</span></td>
                    <td>${item.is_featured ? '<span class="badge badge-success">Sim</span>' : 'N√£o'}</td>
                    <td>${new Date(item.created_at).toLocaleDateString('pt-BR')}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-edit">Editar</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        } else if (currentModel === 'testimonials') {
            tbody.innerHTML = currentData.map(item => `
                <tr>
                    <td>${item.name}</td>
                    <td>${item.position}</td>
                    <td>${item.content}</td>
                    <td>${item.is_active ? '<span class="badge badge-success">Ativo</span>' : '<span class="badge badge-danger">Inativo</span>'}</td>
                    <td>${item.order}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-edit">Editar</button>
                            <button class="btn-action btn-delete">Excluir</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        } else if (currentModel === 'planos') {
            tbody.innerHTML = currentData.map(item => `
                <tr>
                    <td>${item.nome}</td>
                    <td>${item.categoria}</td>
                    <td>R$ ${item.preco}</td>
                    <td>${item.preco_antigo ? 'R$ ' + item.preco_antigo : 'N/A'}</td>
                    <td>${item.ativo ? '<span class="badge badge-success">Ativo</span>' : '<span class="badge badge-danger">Inativo</span>'}</td>
                    <td>${item.destaque ? '<span class="badge badge-warning">Sim</span>' : 'N√£o'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-edit">Editar</button>
                            <button class="btn-action btn-delete">Excluir</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        } else if (currentModel === 'documents') {
            tbody.innerHTML = currentData.map(item => `
                <tr>
                    <td>${item.titulo}</td>
                    <td>${item.usuario}</td>
                    <td><span class="badge badge-info">${item.categoria}</span></td>
                    <td>${item.visivel_para_cliente ? '<span class="badge badge-success">Sim</span>' : 'N√£o'}</td>
                    <td>${new Date(item.criado_em).toLocaleDateString('pt-BR')}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-view">Ver</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
    }

    // Atualizar contadores
    function updateCounts() {
        if (currentModel === 'leads') {
            const pendingLeads = currentData.filter(l => !l.contatado).length;
            document.getElementById('leads-count').textContent = pendingLeads;
        } else if (currentModel === 'chamados') {
            document.getElementById('chamados-count').textContent = currentData.length;
        }
    }

    // Enviar mensagem via WhatsApp
    function sendWhatsApp(leadName, leadPhone, servicoInteresse) {
        const phone = leadPhone.replace(/\D/g, '');
        const message = `Ol√° ${leadName}! üëã\n\nSomos da Vetorial Contabilidade e vimos que voc√™ demonstrou interesse em nossos servi√ßos de ${servicoInteresse}.\n\nEstamos √† disposi√ß√£o para esclarecer qualquer d√∫vida e apresentar nossas solu√ß√µes personalizadas para o seu neg√≥cio.\n\nPodemos agendar uma conversa?`;
        const whatsappUrl = `https://wa.me/55${phone}?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');
    }

    // Ver detalhes do chamado
    async function viewChamado(id) {
        currentChamadoId = id;
        try {
            const response = await fetch(`${API_BASE}/chamados/${id}/`);
            const result = await response.json();
            
            if (result.success) {
                const chamado = result.data;
                
                // Preencher t√≠tulo e informa√ß√µes
                document.getElementById('chamadoTitle').textContent = `${chamado.protocolo} - ${chamado.titulo}`;
                document.getElementById('chamadoInfo').innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; padding: 16px; background: #F9FAFB; border-radius: 12px;">
                        <div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 4px;">Cliente</div>
                            <div style="font-weight: 600;">${chamado.cliente}</div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">${chamado.cliente_email}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 8px;">Status do Ticket</div>
                            <select id="statusSelect" style="width: 100%; padding: 8px 12px; border-radius: 6px; border: 1px solid var(--border-color); font-size: 0.875rem; margin-bottom: 8px;">
                                <option value="aberto" ${chamado.status_value === 'aberto' ? 'selected' : ''}>Aberto</option>
                                <option value="em_andamento" ${chamado.status_value === 'em_andamento' ? 'selected' : ''}>Em Atendimento</option>
                                <option value="resolvido" ${chamado.status_value === 'resolvido' ? 'selected' : ''}>Finalizado</option>
                            </select>
                            <span class="badge badge-warning">${chamado.prioridade}</span>
                        </div>
                        <div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 4px;">Data de Abertura</div>
                            <div>${chamado.data_criacao}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 4px;">√öltima Atualiza√ß√£o</div>
                            <div>${chamado.data_atualizacao}</div>
                        </div>
                        <div style="grid-column: 1 / -1;">
                            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 4px;">Descri√ß√£o</div>
                            <div style="line-height: 1.5;">${chamado.descricao}</div>
                        </div>
                    </div>
                `;
                
                // Renderizar mensagens
                const chatContainer = document.getElementById('chatContainer');
                chatContainer.innerHTML = chamado.mensagens.map(msg => `
                    <div class="chat-message">
                        <div class="message-avatar ${msg.autor_is_staff ? 'staff' : ''}">
                            ${msg.autor.charAt(0).toUpperCase()}
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-author">${msg.autor}</span>
                                ${msg.autor_is_staff ? '<span class="badge badge-success" style="font-size: 0.7rem;">Staff</span>' : ''}
                                <span class="message-time">${msg.criado_em}</span>
                            </div>
                            <div class="message-text">${msg.mensagem}</div>
                            ${msg.anexo_url ? `<a href="${msg.anexo_url}" target="_blank" style="font-size: 0.875rem; color: var(--primary-color);">üìé Anexo</a>` : ''}
                        </div>
                    </div>
                `).join('');
                
                // Scroll para o fim
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                // Abrir modal
                document.getElementById('chamadoModal').classList.add('active');
                
                // Adicionar listener para mudan√ßa de status
                document.getElementById('statusSelect').addEventListener('change', async function() {
                    const novoStatus = this.value;
                    await atualizarStatusChamado(currentChamadoId, novoStatus);
                });
            }
        } catch (error) {
            console.error('Erro ao carregar chamado:', error);
            showAlert('Erro ao carregar detalhes do chamado', 'error');
        }
    }

    // Atualizar status do chamado
    async function atualizarStatusChamado(chamadoId, novoStatus) {
        try {
            const response = await fetch(`${API_BASE}/chamados/${chamadoId}/update-status/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify({ status: novoStatus })
            });
            
            const result = await response.json();
            
            if (result.success) {
                showAlert('Status atualizado com sucesso!');
                // Recarregar lista de chamados
                loadModelData('chamados');
            } else {
                showAlert(result.error || 'Erro ao atualizar status', 'error');
            }
        } catch (error) {
            console.error('Erro ao atualizar status:', error);
            showAlert('Erro ao atualizar status', 'error');
        }
    }

    // Enviar resposta
    async function sendResponse() {
        const message = document.getElementById('respondMessage').value.trim();
        
        if (!message) {
            showAlert('Digite uma mensagem antes de enviar', 'error');
            return;
        }
        
        if (!currentChamadoId) return;
        
        try {
            const response = await fetch(`${API_BASE}/chamados/${currentChamadoId}/respond/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify({ mensagem: message })
            });
            
            const result = await response.json();
            
            if (result.success) {
                showAlert('Resposta enviada com sucesso!');
                document.getElementById('respondMessage').value = '';
                
                // Recarregar mensagens
                viewChamado(currentChamadoId);
            } else {
                showAlert(result.error || 'Erro ao enviar resposta', 'error');
            }
        } catch (error) {
            console.error('Erro ao enviar resposta:', error);
            showAlert('Erro ao enviar resposta', 'error');
        }
    }

    // Fechar modal de chamado
    function closeChamadoModal() {
        document.getElementById('chamadoModal').classList.remove('active');
        currentChamadoId = null;
        document.getElementById('respondMessage').value = '';
    }

    // Abrir modal de NF
    async function openNFModal(clientId = null) {
        // Carregar lista de clientes
        try {
            const response = await fetch(`${API_BASE}/clientes/`);
            const result = await response.json();
            
            if (result.success) {
                const select = document.getElementById('nfCliente');
                select.innerHTML = '<option value="">Selecione um cliente...</option>' + 
                    result.data.map(c => `<option value="${c.id}">${c.nome} (${c.email})</option>`).join('');
                
                if (clientId) {
                    select.value = clientId;
                }

                document.getElementById('nfModal').classList.add('active');
            }
        } catch (error) {
            console.error('Erro ao carregar clientes:', error);
            showAlert('Erro ao carregar lista de clientes', 'error');
        }
    }

    // Fechar modal de NF
    function closeNFModal() {
        document.getElementById('nfModal').classList.remove('active');
        document.getElementById('nfForm').reset();
    }

    // Enviar nota fiscal
    document.getElementById('nfForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData();
        formData.append('cliente_id', document.getElementById('nfCliente').value);
        formData.append('arquivo', document.getElementById('nfArquivo').files[0]);
        formData.append('observacoes', document.getElementById('nfObservacoes').value);
        
        try {
            const response = await fetch(`${API_BASE}/notas-fiscais/enviar/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken
                },
                body: formData
            });
            
            const result = await response.json();
            
            if (result.success) {
                showAlert(result.message);
                closeNFModal();
            } else {
                showAlert(result.error || 'Erro ao enviar nota fiscal', 'error');
            }
        } catch (error) {
            console.error('Erro ao enviar NF:', error);
            showAlert('Erro ao enviar nota fiscal', 'error');
        }
    });

    // Abrir modal de Documento da Empresa
    async function openDocumentoEmpresaModal(clientId = null) {
        // Carregar lista de clientes
        try {
            const response = await fetch(`${API_BASE}/clientes/`);
            const result = await response.json();
            
            if (result.success) {
                const select = document.getElementById('docEmpresaCliente');
                select.innerHTML = '<option value="">Selecione um cliente...</option>' + 
                    result.data.map(c => `<option value="${c.id}">${c.nome} (${c.email})</option>`).join('');
                
                if (clientId) {
                    select.value = clientId;
                }

                document.getElementById('documentoEmpresaModal').classList.add('active');
            }
        } catch (error) {
            console.error('Erro ao carregar clientes:', error);
            showAlert('Erro ao carregar lista de clientes', 'error');
        }
    }

    // Fechar modal de Documento da Empresa
    function closeDocumentoEmpresaModal() {
        document.getElementById('documentoEmpresaModal').classList.remove('active');
        document.getElementById('documentoEmpresaForm').reset();
    }

    // Enviar documento da empresa
    document.getElementById('documentoEmpresaForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData();
        formData.append('cliente_id', document.getElementById('docEmpresaCliente').value);
        formData.append('titulo', document.getElementById('docEmpresaTitulo').value);
        formData.append('categoria', document.getElementById('docEmpresaCategoria').value);
        formData.append('arquivo', document.getElementById('docEmpresaArquivo').files[0]);
        formData.append('descricao', document.getElementById('docEmpresaDescricao').value);
        
        try {
            const response = await fetch(`${API_BASE}/documentos-empresa/enviar/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken
                },
                body: formData
            });
            
            const result = await response.json();
            
            if (result.success) {
                showAlert(result.message);
                closeDocumentoEmpresaModal();
                // Recarregar a interface de documentos
                if (currentModel === 'documentos-empresa') {
                    renderDocumentosEmpresaInterface();
                }
            } else {
                showAlert(result.error || 'Erro ao enviar documento', 'error');
            }
        } catch (error) {
            console.error('Erro ao enviar documento:', error);
            showAlert('Erro ao enviar documento', 'error');
        }
    });

    // Abrir modal de Certid√£o
    async function openCertidaoModal(clientId = null) {
        // Carregar lista de clientes
        try {
            const response = await fetch(`${API_BASE}/clientes/`);
            const result = await response.json();
            
            if (result.success) {
                const select = document.getElementById('certidaoCliente');
                select.innerHTML = '<option value="">Selecione um cliente...</option>' + 
                    result.data.map(c => `<option value="${c.id}">${c.nome} (${c.email})</option>`).join('');
                
                if (clientId) {
                    select.value = clientId;
                }

                document.getElementById('certidaoModal').classList.add('active');
            }
        } catch (error) {
            console.error('Erro ao carregar clientes:', error);
            showAlert('Erro ao carregar lista de clientes', 'error');
        }
    }

    // Fechar modal de Certid√£o
    function closeCertidaoModal() {
        document.getElementById('certidaoModal').classList.remove('active');
        document.getElementById('certidaoForm').reset();
    }

    // Enviar certid√£o
    document.getElementById('certidaoForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData();
        formData.append('cliente_id', document.getElementById('certidaoCliente').value);
        formData.append('tipo_certidao', document.getElementById('certidaoTipo').value);
        formData.append('status', document.getElementById('certidaoStatus').value);
        formData.append('arquivo', document.getElementById('certidaoArquivo').files[0]);
        
        try {
            const response = await fetch(`${API_BASE}/certidoes/enviar/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken
                },
                body: formData
            });
            
            const result = await response.json();
            
            if (result.success) {
                showAlert(result.message);
                closeCertidaoModal();
                // Recarregar a interface de certid√µes
                if (currentModel === 'certidoes') {
                    renderCertidoesInterface();
                }
            } else {
                showAlert(result.error || 'Erro ao enviar certid√£o', 'error');
            }
        } catch (error) {
            console.error('Erro ao enviar certid√£o:', error);
            showAlert('Erro ao enviar certid√£o', 'error');
        }
    });

    // === GUIA MODAL FUNCTIONS ===
    function openGuiaModal(clientId = null) {
        document.getElementById('guiaModal').classList.add('active');
        const idToUse = clientId || currentSelectedClientId;
        if(idToUse) {
             document.getElementById('guiaClienteVal').value = idToUse;
        }
    }
    
    function closeGuiaModal() {
        document.getElementById('guiaModal').classList.remove('active');
        document.getElementById('guiaForm').reset();
    }
    
    document.getElementById('guiaForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        // Ensure cliente_id is set
        if(!formData.get('cliente_id') && currentSelectedClientId) {
            formData.set('cliente_id', currentSelectedClientId);
        }
        formData.append('arquivo', document.getElementById('guiaArquivo').files[0]);

        try {
            const resp = await fetch(`${API_BASE}/guias/enviar/`, {
                method: 'POST',
                headers: {'X-CSRFToken': csrftoken},
                body: formData
            });
            const d = await resp.json();
            if(d.success) {
                alert('Guia enviada com sucesso!');
                closeGuiaModal();
                // Refresh list logic if simple enough, else just close
            } else {
                alert('Erro: ' + d.error);
            }
        } catch(e) {
            console.error(e);
            alert('Erro ao enviar guia');
        }
    });

    // Handle Quick Actions Override (Move startAction here or update existing)
    // Note: startAction was defined earlier in replace_string, but we can override or ensure logic matches.
    
    // Carregar dados iniciais e for√ßar modo Board
    loadModelData('clientes'); // Carregar clientes
    // document.querySelector('.menu-item[data-model="chamados"]').classList.add('active'); // Sidebar removed
</script>
</body>
</html>
