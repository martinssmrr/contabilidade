{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{% block title %}Vetorial - A Melhor Contabilidade Online{% endblock %}</title>

    <!-- Google Tag Manager -->
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=	G-70MDDS47FX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-70MDDS47FX');
    </script>
    <!-- End Google Tag Manager -->
    
    <!-- Microsoft Clarity -->
     <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "v7j10471jt");
    </script>

    <!-- SEO Meta Tags -->
    <meta name="description" content="{% block description %}Abra sua empresa sem burocracia com a Vetorial. Contabilidade online especializada em abertura de empresas, planejamento tributário e gestão contábil.{% endblock %}">
    <meta name="keywords" content="{% block keywords %}contabilidade, vetorial contabilidade, contabilidade online, abrir empresa, abrir cnpj, abertura de empresa, contador online, planejamento tributário{% endblock %}">
    <meta name="author" content="Vetorial Contabilidade">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://vetorialcontabilidade.com.br{% block canonical %}{% endblock %}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://vetorialcontabilidade.com.br{% block og_url %}{% endblock %}">
    <meta property="og:title" content="{% block og_title %}Vetorial - A Melhor Contabilidade Online{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Abra sua empresa sem burocracia com a Vetorial. Contabilidade online especializada.{% endblock %}">
    <meta property="og:image" content="{% block og_image %}https://vetorialcontabilidade.com.br{% static 'img/logo.webp' %}{% endblock %}">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://vetorialcontabilidade.com.br{% block twitter_url %}{% endblock %}">
    <meta property="twitter:title" content="{% block twitter_title %}Vetorial - A Melhor Contabilidade Online{% endblock %}">
    <meta property="twitter:description" content="{% block twitter_description %}Abra sua empresa sem burocracia com a Vetorial.{% endblock %}">
    <meta property="twitter:image" content="{% block twitter_image %}https://vetorialcontabilidade.com.br{% static 'img/logo.webp' %}{% endblock %}">
    
    <!-- Preconnect para recursos externos (antes do CSS) -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <link rel="preload" as="image" href="{% static 'img/herosection.webp' %}">
    
    <!-- CSS Crítico Inline - Above the Fold -->
    <style>
        :root{--primary-color:#3ef47c;--primary-dark:#2ed66b;--secondary-color:#0c63d1;--secondary-dark:#0a4fa3;--dark-color:#1f2937;--light-color:#f9fafb;--white-color:#fff;--gray-color:#6b7280}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter','Segoe UI',Roboto,sans-serif;min-height:100vh;display:flex;flex-direction:column;background-color:var(--light-color);color:var(--dark-color);line-height:1.6;overflow-x:hidden}
        main{flex:1;padding:0;margin:0;width:100%}
        
        /* Bootstrap Grid Crítico */
        .container,.container-fluid{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}
        @media(min-width:576px){.container{max-width:540px}}
        @media(min-width:768px){.container{max-width:720px}}
        @media(min-width:992px){.container{max-width:960px}}
        @media(min-width:1200px){.container{max-width:1140px}}
        .row{display:flex;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}
        .col,.col-1,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-10,.col-11,.col-12,.col-lg-6,.col-lg-5,.col-md-6{position:relative;width:100%;padding-right:15px;padding-left:15px}
        @media(min-width:768px){.col-md-6{flex:0 0 50%;max-width:50%}}
        @media(min-width:992px){.col-lg-5{flex:0 0 41.666667%;max-width:41.666667%}.col-lg-6{flex:0 0 50%;max-width:50%}}
        
        /* Utilitários Bootstrap Críticos */
        .d-flex{display:flex!important}.d-none{display:none!important}.d-block{display:block!important}
        .justify-content-center{justify-content:center!important}.justify-content-between{justify-content:space-between!important}
        .align-items-center{align-items:center!important}.flex-column{flex-direction:column!important}
        .text-center{text-align:center!important}.text-white{color:#fff!important}
        .fw-bold{font-weight:700!important}.fw-semibold{font-weight:600!important}
        .mb-0{margin-bottom:0!important}.mb-2{margin-bottom:.5rem!important}.mb-3{margin-bottom:1rem!important}.mb-4{margin-bottom:1.5rem!important}
        .mt-3{margin-top:1rem!important}.mt-4{margin-top:1.5rem!important}
        .py-3{padding-top:1rem!important;padding-bottom:1rem!important}.py-5{padding-top:3rem!important;padding-bottom:3rem!important}
        .px-3{padding-left:1rem!important;padding-right:1rem!important}.px-4{padding-left:1.5rem!important;padding-right:1.5rem!important}
        .p-4{padding:1.5rem!important}
        .gap-2{gap:.5rem!important}.gap-3{gap:1rem!important}
        .h1,.h2,.h3,h1,h2,h3{margin-bottom:.5rem;font-weight:700;line-height:1.2}
        .h1,h1{font-size:2.5rem}.h2,h2{font-size:2rem}.h3,h3{font-size:1.75rem}
        .lead{font-size:1.25rem;font-weight:300}
        .img-fluid{max-width:100%;height:auto}
        @media(min-width:992px){.d-lg-block{display:block!important}.d-lg-none{display:none!important}}
        @media(max-width:991.98px){.d-lg-block{display:none!important}}
        
        /* Navbar Crítico */
        .navbar{background:#0a4fa3!important;box-shadow:0 2px 20px rgba(0,0,0,.1);padding:.25rem 0;position:fixed;top:0;width:100%;z-index:1000;transition:all .3s ease}
        .navbar.transparent{background:transparent!important;box-shadow:none;position:absolute}
        .navbar.scrolled{background:#0a4fa3!important;box-shadow:0 2px 20px rgba(0,0,0,.1);position:fixed;top:0}
        .navbar-brand{font-size:1.5rem;font-weight:700;letter-spacing:.5px;display:flex;align-items:center;gap:.75rem}
        .navbar-brand img{height:75px;width:auto;filter:brightness(0) invert(1)}
        .navbar-nav{display:flex;flex-direction:column;padding-left:0;margin-bottom:0;list-style:none}
        @media(min-width:992px){.navbar-nav{flex-direction:row}}
        .nav-link{display:block;padding:.5rem 1rem;color:rgba(255,255,255,.9);text-decoration:none;font-weight:500;transition:all .3s ease}
        .nav-link:hover{color:var(--primary-color)!important}
        .navbar-toggler{padding:.25rem .75rem;font-size:1.25rem;line-height:1;background-color:transparent;border:1px solid rgba(255,255,255,.3);border-radius:.375rem}
        .navbar-toggler-icon{display:inline-block;width:1.5em;height:1.5em;vertical-align:middle;background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 0.9%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");background-repeat:no-repeat;background-position:center;background-size:100%}
        .navbar-collapse{flex-basis:100%;flex-grow:1;align-items:center}
        @media(min-width:992px){.navbar-expand-lg .navbar-collapse{display:flex!important;flex-basis:auto}.navbar-expand-lg .navbar-toggler{display:none}}
        @media(max-width:991.98px){.navbar-collapse{display:none}.navbar-collapse.show{display:block}}
        
        /* Hero Section Crítico */
        .hero-section{position:relative;overflow:hidden;background-size:cover;background-position:center top;background-repeat:no-repeat;height:850px;display:flex;align-items:center;padding:0!important;margin:0!important;width:100vw;padding-top:100px!important}
        .hero-section .container{padding-top:0!important;padding-bottom:0!important;max-width:100%;width:100%;position:relative;z-index:1}
        .hero-section::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle at 30% 50%,rgba(62,244,124,.1) 0%,transparent 50%);pointer-events:none}
        
        /* Botões Críticos */
        .btn{display:inline-block;font-weight:500;line-height:1.5;text-align:center;text-decoration:none;vertical-align:middle;cursor:pointer;user-select:none;border:1px solid transparent;padding:.5rem 1rem;font-size:1rem;border-radius:.375rem;transition:all .3s ease}
        .btn-primary{color:#fff;background-color:var(--secondary-color);border-color:var(--secondary-color)}
        .btn-primary:hover{background-color:var(--secondary-dark);border-color:var(--secondary-dark)}
        .btn-success{color:#fff;background-color:var(--primary-color);border-color:var(--primary-color)}
        .btn-success:hover{background-color:var(--primary-dark);border-color:var(--primary-dark)}
        .btn-lg{padding:.75rem 1.5rem;font-size:1.125rem;border-radius:.5rem}
        .btn-outline-primary{color:var(--secondary-color);border-color:var(--secondary-color);background-color:transparent}
        .btn-outline-primary:hover{color:#fff;background-color:var(--secondary-color)}
        .rounded-pill{border-radius:50rem!important}
        
        /* Footer Crítico */
        .site-footer{background:#0f1724;color:#e6eef8;font-size:14px;line-height:1.4}
        .site-footer a{color:#cfe7ff;text-decoration:none}
    </style>
    
    <!-- CSS Externo -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}?v={{ STATIC_VERSION|default:'1.0' }}">
    <link rel="stylesheet" href="{% static 'css/footer.css' %}?v={{ STATIC_VERSION|default:'2.0' }}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon.png' %}">
    <link rel="apple-touch-icon" href="{% static 'img/favicon.png' %}">
    
    <!-- Schema.org JSON-LD -->
    <script type="application/ld+json">
    {% include 'schema_org.json' %}
    </script>
    
    {% block extra_css %}{% endblock %}

    <style>
        .hover-lift { transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .hover-lift:hover { transform: translateY(-3px); box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important; }
        .form-control:focus, .form-select:focus { border-color: #3ef47c; box-shadow: 0 0 0 0.25rem rgba(62, 244, 124, 0.25); }
        .modal-content { border: none; }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=AW-17807873091"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
     
    <!-- Navbar -->
    {% include 'partials/navbar.html' %}
    
    <!-- Mensagens do Django -->
    {% if messages %}
        <div class="container mt-3">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        </div>
    {% endif %}
    
    <!-- Conteúdo principal -->
    <main>
        {% block content %}
        {% endblock %}
    </main>
    
    <!-- Footer -->
    {% include 'partials/footer.html' %}
    
    <!-- JavaScript - Carregamento Deferido -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="{% static 'js/script.js' %}" defer></script>
    
    <!-- Modal de Captura de Lead WhatsApp -->
    <div class="modal fade" id="whatsappLeadModal" tabindex="-1" aria-labelledby="whatsappLeadModalLabel" aria-hidden="true" style="z-index: 10000;">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg" style="border-radius: 20px; overflow: hidden;">
          <!-- Header Personalizado -->
          <div class="modal-header text-white border-0" style="background: linear-gradient(135deg, #0c63d1 0%, #0a4fa3 100%); padding: 1.5rem 1.5rem 1rem;">
            <div class="d-flex align-items-center w-100">
                <div class="me-3 d-flex align-items-center justify-content-center shadow-sm" style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 50%; backdrop-filter: blur(5px);">
                    <i class="fab fa-whatsapp fa-xl"></i>
                </div>
                <div>
                    <h5 class="modal-title fw-bold mb-0" id="whatsappLeadModalLabel" style="font-size: 1.25rem;">Falar com Consultor</h5>
                    <p class="mb-0 small" style="opacity: 0.9;">Atendimento ágil pelo WhatsApp</p>
                </div>
            </div>
            <button type="button" class="btn-close btn-close-white align-self-start" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          
          <div class="modal-body p-4" style="background-color: #f8f9fa;">
            <p class="text-center mb-4" style="color: #6c757d; font-size: 0.95rem;">
                Preencha seus dados para ser redirecionado(a) ao nosso atendimento prioritário.
            </p>
            
            <form id="leadCaptureForm">
              <div class="mb-3">
                <label for="leadNome" class="form-label small fw-bold text-uppercase text-secondary" style="font-size: 0.75rem; letter-spacing: 0.5px;">Nome Completo *</label>
                <div class="input-group shadow-sm" style="border-radius: 8px; overflow: hidden;">
                    <span class="input-group-text bg-white border-end-0 text-muted ps-3"><i class="fas fa-user"></i></span>
                    <input type="text" class="form-control border-start-0 ps-2 py-2" id="leadNome" placeholder="Digite seu nome" required style="border-left: none;">
                </div>
              </div>
              
              <div class="mb-3">
                <label for="leadEmail" class="form-label small fw-bold text-uppercase text-secondary" style="font-size: 0.75rem; letter-spacing: 0.5px;">E-mail *</label>
                <div class="input-group shadow-sm" style="border-radius: 8px; overflow: hidden;">
                    <span class="input-group-text bg-white border-end-0 text-muted ps-3"><i class="fas fa-envelope"></i></span>
                    <input type="email" class="form-control border-start-0 ps-2 py-2" id="leadEmail" placeholder="seu@email.com" required style="border-left: none;">
                </div>
              </div>
              
              <div class="row g-2">
                  <div class="col-7 mb-3">
                    <label for="leadTelefone" class="form-label small fw-bold text-uppercase text-secondary" style="font-size: 0.75rem; letter-spacing: 0.5px;">Telefone (DDD) *</label>
                    <div class="input-group shadow-sm" style="border-radius: 8px; overflow: hidden;">
                        <span class="input-group-text bg-white border-end-0 text-muted ps-3"><i class="fab fa-whatsapp"></i></span>
                        <input type="text" class="form-control border-start-0 ps-2 py-2" id="leadTelefone" placeholder="(11) 99999-9999" required style="border-left: none;">
                    </div>
                  </div>
                  <div class="col-5 mb-3">
                    <label for="leadEstado" class="form-label small fw-bold text-uppercase text-secondary" style="font-size: 0.75rem; letter-spacing: 0.5px;">Estado *</label>
                    <select class="form-select shadow-sm py-2" id="leadEstado" required style="border-radius: 8px;">
                      <option value="" selected disabled>UF</option>
                      <option value="AC">AC</option>
                      <option value="AL">AL</option>
                      <option value="AP">AP</option>
                      <option value="AM">AM</option>
                      <option value="BA">BA</option>
                      <option value="CE">CE</option>
                      <option value="DF">DF</option>
                      <option value="ES">ES</option>
                      <option value="GO">GO</option>
                      <option value="MA">MA</option>
                      <option value="MT">MT</option>
                      <option value="MS">MS</option>
                      <option value="MG">MG</option>
                      <option value="PA">PA</option>
                      <option value="PB">PB</option>
                      <option value="PR">PR</option>
                      <option value="PE">PE</option>
                      <option value="PI">PI</option>
                      <option value="RJ">RJ</option>
                      <option value="RN">RN</option>
                      <option value="RS">RS</option>
                      <option value="RO">RO</option>
                      <option value="RR">RR</option>
                      <option value="SC">SC</option>
                      <option value="SP">SP</option>
                      <option value="SE">SE</option>
                      <option value="TO">TO</option>
                    </select>
                  </div>
              </div>
            </form>
          </div>
          
          <div class="modal-footer border-0 p-4 pt-0 bg-light justify-content-center flex-column">
            <button type="button" class="btn btn-success w-100 py-3 fw-bold shadow hover-lift" id="btnSubmitLead" style="border-radius: 12px; font-size: 1.1rem; background: linear-gradient(135deg, #25d366 0%, #128c7e 100%); border: none;">
                Iniciar Conversa <i class="fas fa-paper-plane ms-2"></i>
            </button>
            <button type="button" class="btn btn-link text-muted btn-sm text-decoration-none mt-2" data-bs-dismiss="modal">Cancelar e fechar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Script de Interceptação do WhatsApp -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        let leadModal; 
        try {
            leadModal = new bootstrap.Modal(document.getElementById('whatsappLeadModal'));
        } catch (e) {
            console.error('Bootstrap Modal initialization failed:', e);
            return;
        }
        
        let originalUrl = '';

        // Intercepta cliques
        document.body.addEventListener('click', function(e) {
            const target = e.target.closest('a');
            if (!target) return;

            const href = target.getAttribute('href');
            if (href && (href.includes('wa.me') || href.includes('api.whatsapp.com') || href.includes('whatsapp.com/send'))) {
                e.preventDefault();
                originalUrl = href;
                leadModal.show();
            }
        });
        
        // Máscara de telefone simples
        const phoneInput = document.getElementById('leadTelefone');
        phoneInput.addEventListener('input', function (e) {
            let x = e.target.value.replace(/\D/g, '').match(/(\d{0,2})(\d{0,5})(\d{0,4})/);
            e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
        });

        // Envio do formulário
        document.getElementById('btnSubmitLead').addEventListener('click', function() {
            const nome = document.getElementById('leadNome').value.trim();
            const email = document.getElementById('leadEmail').value.trim();
            const telefone = document.getElementById('leadTelefone').value.trim();
            const estado = document.getElementById('leadEstado').value;

            if (!nome || !email || !telefone || !estado) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            // Validação de email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                 alert('Por favor, insira um e-mail válido.');
                 return;
            }

            const btn = this;
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Enviando...';

            const payload = {
                nome_completo: nome,
                email: email,
                telefone: telefone,
                estado: estado,
                origem: 'WhatsApp Intercept',
                servico_interesse: 'Contato via WhatsApp'
            };

            const csrfTokenElement = document.querySelector('[name=csrfmiddlewaretoken]');
            // Se não encontrar o input, tenta usar o cookie ou uma string vazia (view é csrf_exempt, mas bom enviar)
            const csrfToken = '{{ csrf_token }}'; 

            fetch('/support/capturar-lead/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify(payload)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Rastreamento Google Ads/Analytics (opcional, mas recomendado)
                    if (typeof gtag === 'function') {
                        gtag('event', 'generate_lead', {
                            'event_category': 'WhatsApp',
                            'event_label': 'Intercept Modal'
                        });
                    }

                    leadModal.hide();
                    
                    // Constrói mensagem personalizada para o WhatsApp
                    const msg = `Olá, meu nome é ${nome}.\nEmail: ${email}\nTelefone: ${telefone}\nEstado: ${estado}\nGostaria de atendimento.`;
                    const encodedMsg = encodeURIComponent(msg);
                    
                    // Adiciona a mensagem à URL original
                    let finalUrl = originalUrl;
                    if (finalUrl.includes('?')) {
                        // Verifica se existe o parâmetro text
                        if (finalUrl.match(/[?&]text=[^&]*/)) {
                            // Substitui o texto existente
                            finalUrl = finalUrl.replace(/([?&])text=[^&]*/, '$1text=' + encodedMsg);
                        } else {
                            // Adiciona como novo parâmetro
                            finalUrl += '&text=' + encodedMsg;
                        }
                    } else {
                        // Criar query string
                        finalUrl += '?text=' + encodedMsg;
                    }
                    
                    // Redireciona em nova aba
                    window.open(finalUrl, '_blank');
                    
                    // Restaura o botão após o clique
                    setTimeout(() => {
                        btn.disabled = false;
                        btn.innerHTML = originalText;
                    }, 500);
                } else {
                    alert('Erro ao processar: ' + (data.message || 'Tente novamente.'));
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }
            })
            .catch(error => {
                console.error('Erro na captura:', error);
                // Fallback: redireciona mesmo com erro para não perder o clique
                leadModal.hide();
                window.open(originalUrl, '_blank');
                
                btn.disabled = false;
                btn.innerHTML = originalText;
            });
        });
    });
    </script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17807873091"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-17807873091');
    </script>
    
    <script src="{% static 'js/testimonials-scroll.js' %}"></script>

    <!-- Chatbot Widget -->
    {% include 'partials/chatbot_widget.html' %}

    {% block extra_js %}{% endblock %}
</body>
</html>
