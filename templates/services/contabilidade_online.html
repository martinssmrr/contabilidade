{% extends 'base.html' %}
{% load static %}
{% load blog_tags %}

{% block title %}Abrir MEI - Vetorial Contabilidade{% endblock %}

{% block extra_css %}

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>

    /* Orbita Section Styles - Nova Seção */
    .orbit-bg {
        background-color: #ebeef1; /* Light background */
        position: relative;
        overflow: hidden;
    }
    
    .orbit-card {
        background: rgba(255, 255, 255, 0.85); /* Semi-transparent */
        backdrop-filter: blur(5px);
        border-radius: 16px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid rgba(255,255,255,0.6);
    }
    
    .orbit-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
        background: rgba(255, 255, 255, 0.98);
        border-color: #fff;
    }
    
    .orbit-main-img {
        width: 380px;
        height: 380px;
        object-fit: cover;
        border: 10px solid rgba(255,255,255,0.8);
        box-shadow: 0 20px 40px rgba(26, 35, 126, 0.15);
        z-index: 10;
        position: relative;
    }

    .orbit-image-container {
        position: relative;
        display: inline-block;
    }

    /* Orbit Rings Effect */
    .orbit-image-container::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 140%;
        height: 140%;
        border: 1px dashed rgba(26, 35, 126, 0.1);
        border-radius: 50%;
        z-index: 0;
        pointer-events: none;
    }

    @media (min-width: 992px) {
        .orbit-col-left .orbit-card {
            text-align: right;
            margin-right: 0; 
            position: relative;
        }
        
        /* Curve Effect - Middle card pushed OUTWARD */
        .orbit-col-left .orbit-card:nth-child(2) {
            margin-right: 60px; 
            z-index: 5;
        }
        
        .orbit-col-right .orbit-card {
            text-align: left;
            margin-left: 0;
            position: relative;
        }

        /* Curve Effect - Middle card pushed OUTWARD */
        .orbit-col-right .orbit-card:nth-child(2) {
            margin-left: 60px; 
            z-index: 5;
        }
    }
    
    @media (max-width: 991px) {
        .orbit-main-img {
             width: 250px;
             height: 250px;
             margin-bottom: 2rem;
        }
        .orbit-card {
            text-align: center;
            background: #ffffff; /* Solid on mobile for better reading */
        }
        .orbit-image-container::before {
            display: none;
        }
    }
    
    /* Class identical to home.html for consistency */
    .section-title-blue {
        color: #1A237E;
        font-weight: 700;
    }

    /* Estilos adicionais para os novos cards de serviços */
    .svc-section .svc-center { min-height: 550px; }

    .svc-section .box-a { top: 38%; }
    .svc-section .box-b { top: 61%; }
    .svc-section .box-d { top: 38%; }
    .svc-section .box-e { top: 61%; }

    .svc-section .box-f { position: absolute; left: calc(50% - 560px); top: 15%; transform: translateY(-50%); }
    .svc-section .box-g { position: absolute; left: calc(50% - 560px); top: 84%; transform: translateY(-50%); }
    .svc-section .box-h { position: absolute; right: calc(50% - 560px); top: 15%; transform: translateY(-50%); }
    .svc-section .box-i { position: absolute; right: calc(50% - 560px); top: 84%; transform: translateY(-50%); }

    @media (max-width: 576px) {
        .svc-section .box-f, .svc-section .box-g, .svc-section .box-h, .svc-section .box-i {
            position: static;
            width: calc(100% - 40px);
            max-width: 520px;
            margin: 0 auto;
            justify-content: flex-start;
        }
    }

    /* Depoimentos */

    .autor-foto {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
    }

    .depoimento-card {
        background: var(--white);
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        position: relative;
        height: 100%;
    }

    .depoimento-card::before {
        content: '"';
        font-size: 6rem;
        color: rgba(12, 99, 209, 0.1);
        position: absolute;
        top: 10px;
        left: 25px;
        font-family: Georgia, serif;
        line-height: 1;
    }

    .depoimento-texto {
        font-style: italic;
        color: var(--text-light);
        margin-bottom: 25px;
        position: relative;
        z-index: 1;
    }

    .depoimento-autor {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .autor-avatar {
        width: 60px;
        height: 60px;
        background-size: cover;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .autor-avatar i {
        font-size: 1.5rem;
        color: var(--white);
    }

    .testimonials-scroll {
    overflow-x: auto;
    scroll-behavior: smooth;
    padding-bottom: 20px;
    }

    .testimonials-scroll::-webkit-scrollbar {
    height: 8px;
    }

    .testimonials-scroll::-webkit-scrollbar-thumb {
    background: #c5c5c5;
    border-radius: 4px;
    }

    .depoimento-card-wrapper {
    min-width: calc(33.33% - 1rem); /* 3 por tela */
    }

    @media (max-width: 992px) { /* Tablet */
    .depoimento-card-wrapper {
        min-width: 50%; /* 2 por tela */
    }
    }

    @media (max-width: 576px) { /* Mobile */
    .depoimento-card-wrapper {
        min-width: 85%; /* 1 por tela */
    }
    }

/* FAQ expand/collapse */
.faq-item { border-bottom: 1px solid rgba(0,0,0,0.06); }
.faq-question { background: transparent; border: 0; width: 100%; text-align: left; padding: 1rem; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
.faq-answer { max-height: 0; overflow: hidden; transition: max-height 0.35s ease; }
.faq-item.open .faq-answer { /* when open, max-height updated by JS to scrollHeight for smooth animation */ }
.faq-answer-content { padding: 0 1rem 1rem; }
.faq-icon { display: inline-flex; align-items: center; transition: transform 0.25s ease; }
.faq-item.open .faq-icon { transform: rotate(180deg); }
</style>
{% endblock %}

{% block content %}

<!-- Hero Section -->
<section class="hero-section text-white position-relative" style="background: linear-gradient(135deg, rgba(12, 99, 209, 0.50) 0%, rgba(10, 79, 163, 0.50) 100%), url('{% static 'img/contabilidadeonline.webp' %}'); background-size: cover; background-position: center right;">
    <div class="container-fluid">
        <div class="row align-items-center" style="min-height: 75vh; padding-bottom: 1rem;">
            <!-- Coluna Esquerda - Conteúdo -->
            <div class="col-lg-6 col-12 animate-fade-in px-5">
                <h1 class="display-3 fw-bold mb-4">Seu MEI está em risco? Resolva agora antes que vire multa, bloqueio ou desenquadramento</h1>
                <p class="fs-5 mb-4">Se você não consegue emitir notas, recebeu aviso da Receita, está perto de estourar o limite do MEI ou simplesmente não sabe se ainda pode continuar como MEI, atenção: ignorar o problema sai caro.</p>
                <div class="d-grid gap-3 d-sm-flex mb-4">
                    <button type="button" class="btn btn-light btn-lg px-5" data-bs-toggle="modal" data-bs-target="#contactModal">FALE COM UM ESPECIALISTA</button>
                </div>
            </div>
            <!-- Coluna Direita - Vazia (imagem de fundo aparece aqui) -->
            <div class="col-lg-6 d-none d-lg-block">
                <!-- Espaço para a imagem de fundo aparecer -->
            </div>
        </div>
    </div>
</section>


{# Seção de Artigos Relacionados #}
{% show_recent_posts 'deixar-mei' 3 %}

{% endblock %}

{% block extra_js %}
<script>
// JavaScript da home.html necessário para toggle de planos
document.addEventListener('DOMContentLoaded', function() {
    // Toggle entre planos
    const toggleButtons = document.querySelectorAll('.toggle-btn');
    toggleButtons.forEach(button => {
        button.addEventListener('click', function() {
            const targetType = this.getAttribute('data-toggle');
            
            // Remover active de todos
            toggleButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // Mostrar/esconder planos
            document.getElementById('planos-servicos').style.display = targetType === 'servicos' ? 'block' : 'none';
            document.getElementById('planos-comercio').style.display = targetType === 'comercio' ? 'block' : 'none';
        });
    });
});

// Função para enviar formulário de contato
function enviarFormularioContato() {
    const nome = document.getElementById('nome').value;
    const email = document.getElementById('emailForm').value;
    const telefone = document.getElementById('telefoneForm').value;
    const estado = document.getElementById('estadoForm').value;
    const cidade = document.getElementById('cidadeForm').value;
    const servico = document.getElementById('servicoForm').value;

    if (!nome || !email || !telefone || !estado || !cidade || !servico) {
        alert('Por favor, preencha todos os campos obrigatórios.');
        return;
    }

    const formData = {
        nome_completo: nome,
        email: email,
        telefone: telefone,
        estado: estado,
        cidade: cidade,
        servico_interesse: servico,
        origem: 'pagina_abrir_empresa'
    };

    fetch('/support/capturar-lead/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Obrigado! Entraremos em contato em breve.');
            document.getElementById('contactFormSection').reset();
        } else {
            alert('Erro ao enviar formulário. Tente novamente.');
        }
    })
    .catch(error => {
        console.error('Erro:', error);
        alert('Erro ao enviar formulário. Tente novamente.');
    });
}

// Função auxiliar para pegar CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Funções do Modal Popup
function validarFormulario() {
    const nome = document.getElementById('nomeCompleto').value;
    const email = document.getElementById('email').value;
    const telefone = document.getElementById('telefone').value;
    const estado = document.getElementById('estado').value;
    const cidade = document.getElementById('cidade').value;
    const servico = document.getElementById('servico').value;

    if (!nome || !email || !telefone || !estado || !cidade || !servico) {
        alert('Por favor, preencha todos os campos obrigatórios!');
        return false;
    }

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        alert('Por favor, insira um e-mail válido!');
        return false;
    }

    return true;
}

async function enviarWhatsApp() {
    if (!validarFormulario()) return;

    const nome = document.getElementById('nomeCompleto').value;
    const email = document.getElementById('email').value;
    const telefone = document.getElementById('telefone').value;
    const estado = document.getElementById('estado').value;
    const cidade = document.getElementById('cidade').value;
    const servicoSelect = document.getElementById('servico');
    const servicoValue = servicoSelect.value;
    const servicoText = servicoSelect.options[servicoSelect.selectedIndex].text;

    try {
        const response = await fetch('/support/capturar-lead/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                nome_completo: nome,
                email: email,
                telefone: telefone,
                estado: estado,
                cidade: cidade,
                servico_interesse: servicoValue,
                origem: 'popup_abrir_empresa'
            })
        });
    } catch (error) {
        console.error('Erro ao capturar lead:', error);
    }

    const mensagem = `Olá! Gostaria de solicitar informações sobre o serviço:\n\n` +
                    `Nome: ${nome}\n` +
                    `Email: ${email}\n` +
                    `Telefone: ${telefone}\n` +
                    `Localização: ${cidade} - ${estado}\n` +
                    `Serviço: ${servicoText}`;

    const whatsappNumber = '551131642284';
    const url = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(mensagem)}`;
    window.open(url, '_blank');
}

async function enviarLigacao() {
    if (!validarFormulario()) return;

    const nome = document.getElementById('nomeCompleto').value;
    const email = document.getElementById('email').value;
    const telefone = document.getElementById('telefone').value;
    const estado = document.getElementById('estado').value;
    const cidade = document.getElementById('cidade').value;
    const servicoSelect = document.getElementById('servico');
    const servicoValue = servicoSelect.value;
    const servicoText = servicoSelect.options[servicoSelect.selectedIndex].text;

    try {
        const response = await fetch('/support/capturar-lead/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                nome_completo: nome,
                email: email,
                telefone: telefone,
                estado: estado,
                cidade: cidade,
                servico_interesse: servicoValue,
                origem: 'popup_abrir_empresa'
            })
        });

        const result = await response.json();
        if (result.success) {
            alert(`Obrigado, ${nome}!\n\nEntraremos em contato no número ${telefone} para falar sobre: ${servicoText}\n\nAguarde nosso retorno em breve!`);
        }
    } catch (error) {
        console.error('Erro ao capturar lead:', error);
        alert(`Obrigado, ${nome}!\n\nEntraremos em contato no número ${telefone} para falar sobre: ${servicoText}\n\nAguarde nosso retorno em breve!`);
    }
    
    var contactModal = bootstrap.Modal.getInstance(document.getElementById('contactModal'));
    contactModal.hide();
}

// Máscara para telefone
document.addEventListener('DOMContentLoaded', function() {
    const telefoneInput = document.getElementById('telefone');
    if (telefoneInput) {
        telefoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
                value = value.replace(/(\d)(\d{4})$/, '$1-$2');
            }
            e.target.value = value;
        });
    }
});
</script>
{% endblock %}