{% extends 'services/abertura_empresa/base_wizard.html' %}

{% block wizard_content %}
<h2 class="form-section-title">üè† Endere√ßo Residencial</h2>

<div class="alert alert-info">
    <i class="fas fa-info-circle me-2"></i>
    Digite o CEP e os campos ser√£o preenchidos automaticamente.
</div>

<div class="form-group">
    <label for="{{ form.cep.id_for_label }}" class="form-label required-field">CEP</label>
    {{ form.cep }}
    <small class="help-text">Digite o CEP para buscar o endere√ßo automaticamente</small>
    {% if form.cep.errors %}
    <div class="text-danger mt-1">{{ form.cep.errors }}</div>
    {% endif %}
</div>

<div class="form-group">
    <label for="{{ form.endereco.id_for_label }}" class="form-label required-field">Endere√ßo</label>
    {{ form.endereco }}
    {% if form.endereco.errors %}
    <div class="text-danger mt-1">{{ form.endereco.errors }}</div>
    {% endif %}
</div>

<div class="row">
    <div class="col-md-4 form-group">
        <label for="{{ form.numero.id_for_label }}" class="form-label required-field">N√∫mero</label>
        {{ form.numero }}
        {% if form.numero.errors %}
        <div class="text-danger mt-1">{{ form.numero.errors }}</div>
        {% endif %}
    </div>
    
    <div class="col-md-8 form-group">
        <label for="{{ form.complemento.id_for_label }}" class="form-label">Complemento</label>
        {{ form.complemento }}
        <small class="help-text">Apartamento, bloco, casa, etc. (opcional)</small>
        {% if form.complemento.errors %}
        <div class="text-danger mt-1">{{ form.complemento.errors }}</div>
        {% endif %}
    </div>
</div>

<div class="form-group">
    <label for="{{ form.bairro.id_for_label }}" class="form-label required-field">Bairro</label>
    {{ form.bairro }}
    {% if form.bairro.errors %}
    <div class="text-danger mt-1">{{ form.bairro.errors }}</div>
    {% endif %}
</div>

<div class="row">
    <div class="col-md-8 form-group">
        <label for="{{ form.cidade.id_for_label }}" class="form-label required-field">Cidade</label>
        {{ form.cidade }}
        {% if form.cidade.errors %}
        <div class="text-danger mt-1">{{ form.cidade.errors }}</div>
        {% endif %}
    </div>
    
    <div class="col-md-4 form-group">
        <label for="{{ form.estado.id_for_label }}" class="form-label required-field">Estado</label>
        {{ form.estado }}
        {% if form.estado.errors %}
        <div class="text-danger mt-1">{{ form.estado.errors }}</div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
    $(document).ready(function() {
        $('#id_cep').on('blur', function() {
            const cep = $(this).val().replace(/\D/g, '');
            
            if (cep.length === 8) {
                $.ajax({
                    url: '{% url "services:buscar_cep" %}',
                    data: { cep: cep },
                    success: function(data) {
                        $('#id_endereco').val(data.endereco);
                        $('#id_bairro').val(data.bairro);
                        $('#id_cidade').val(data.cidade);
                        $('#id_estado').val(data.estado);
                        $('#id_numero').focus();
                    },
                    error: function() {
                        alert('CEP n√£o encontrado ou inv√°lido.');
                    }
                });
            }
        });
    });
</script>
{% endblock %}
